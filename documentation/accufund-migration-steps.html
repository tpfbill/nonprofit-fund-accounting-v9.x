<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step-by-Step AccuFund Migration Guide</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            margin: 40px;
            background-color: #fff;
        }
        h1 {
            color: #1976d2;
            font-size: 28px;
            border-bottom: 2px solid #1976d2;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }
        h2 {
            color: #2e7d32;
            font-size: 22px;
            margin-top: 25px;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        h3 {
            color: #455a64;
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        p {
            margin-bottom: 10px;
        }
        ul, ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        ul {
            list-style-type: disc;
        }
        ol {
            list-style-type: decimal;
        }
        ul ul, ol ol, ul ol, ol ul {
            margin-left: 20px;
        }
        ul ul {
            list-style-type: circle;
        }
        ol ol {
            list-style-type: lower-alpha;
        }
        strong {
            font-weight: bold;
        }
        .section-content {
            margin-bottom: 30px;
        }
        .footer {
            margin-top: 50px;
            border-top: 1px solid #eee;
            padding-top: 10px;
            font-size: 12px;
            color: #777;
            text-align: center;
        }
        .code-block {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        .note {
            background-color: #e8f4fd;
            border-left: 4px solid #1976d2;
            padding: 10px 15px;
            margin: 15px 0;
        }
        .warning {
            background-color: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 10px 15px;
            margin: 15px 0;
        }
        .tip {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 10px 15px;
            margin: 15px 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f5f5f5;
            font-weight: bold;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .step-number {
            display: inline-block;
            width: 24px;
            height: 24px;
            background-color: #1976d2;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 24px;
            margin-right: 10px;
            font-weight: bold;
        }
        .step-title {
            font-weight: bold;
            color: #1976d2;
            font-size: 1.1em;
        }
        .step {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #ddd;
        }
        .step:last-child {
            border-bottom: none;
        }
        .command {
            background-color: #263238;
            color: #fff;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
            margin: 10px 0;
        }
        .checklist {
            list-style-type: none;
            padding-left: 10px;
        }
        .checklist li {
            margin-bottom: 8px;
            position: relative;
            padding-left: 30px;
        }
        .checklist li:before {
            content: "‚òê";
            position: absolute;
            left: 0;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <h1>Step-by-Step AccuFund Migration Guide (v9.0)</h1>

    <div class="section-content">
        <p>This comprehensive guide provides detailed, step-by-step instructions for migrating your financial data from AccuFund to the Nonprofit Fund Accounting System. Follow these instructions carefully to ensure a successful migration with minimal disruption to your operations.</p>
        
        <div class="note">
            <strong>Note:</strong> This guide is updated for version 9.0 of the Nonprofit Fund Accounting System, which includes enhanced support for <em>Inter-Entity Transfers</em> (v9.0) <strong>and the Bank Account Management module</strong> (v9.0+). If you're migrating to an earlier version, some steps may not apply.
        </div>
    </div>

    <div class="section-content">
        <h2>Table of Contents</h2>
        <ol>
            <li><a href="#preparation">Preparation and Assessment</a></li>
            <li><a href="#extraction">Data Extraction from AccuFund</a></li>
            <li><a href="#mapping">Data Mapping and Transformation</a></li>
            <li><a href="#inter-entity">Inter-Entity Transfer Migration (v9.0)</a></li>
            <li><a href="#validation">Data Validation</a></li>
            <li><a href="#import">Data Import Process</a></li>
            <li><a href="#verification">Post-Migration Verification</a></li>
            <li><a href="#troubleshooting">Troubleshooting Common Issues</a></li>
        </ol>
    </div>

    <div id="preparation" class="section-content">
        <h2>1. Preparation and Assessment</h2>
        
        <div class="step">
            <div class="step-title"><span class="step-number">1</span>Create a Migration Project Plan</div>
            <p>Begin by creating a detailed project plan with timeline, resources, and responsibilities.</p>
            <ol>
                <li>Form a migration team with representatives from finance, IT, and management</li>
                <li>Establish a timeline with key milestones and deadlines</li>
                <li>Schedule the migration during a low-activity period (e.g., after month-end closing)</li>
                <li>Create a communication plan to keep stakeholders informed</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">2</span>Assess Your AccuFund Implementation</div>
            <p>Document your current AccuFund setup to understand what needs to be migrated.</p>
            <ul>
                <li>Document your chart of accounts structure and hierarchy</li>
                <li>List all funds and their relationships</li>
                <li>Identify all entities in your organization structure</li>
                <li>Document any customizations or special configurations</li>
                <li>List all reports you regularly use</li>
                <li>Identify any third-party integrations</li>
            </ul>
            
            <div class="tip">
                <strong>Tip:</strong> Use the AccuFund System Administrator module to generate reports on your configuration.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">3</span>Set Up the Migration Environment</div>
            <p>Prepare the technical environment for the migration process.</p>
            <ol>
                <li>Install PostgreSQL if not already installed:</li>
                <div class="command">
                    # For macOS with Homebrew<br>
                    brew install postgresql<br><br>
                    # For Ubuntu/Debian<br>
                    sudo apt update<br>
                    sudo apt install postgresql postgresql-contrib
                </div>
                <li>Create the fund_accounting_db database:</li>
                <div class="command">
                    createdb -U postgres fund_accounting_db
                </div>
                <li>Clone the Nonprofit Fund Accounting repository:</li>
                <div class="command">
                    git clone https://github.com/tpfbill/nonprofit-fund-accounting.git<br>
                    cd nonprofit-fund-accounting<br>
                    git checkout v9.0
                </div>
                <li>Install Node.js dependencies:</li>
                <div class="command">
                    npm install
                </div>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">4</span>Create a Backup of Your AccuFund Data</div>
            <p>Before proceeding, ensure you have a complete backup of your AccuFund database.</p>
            <ol>
                <li>Use AccuFund's backup utility to create a full system backup</li>
                <li>Verify the backup is complete and can be restored if needed</li>
                <li>Store the backup in a secure location</li>
            </ol>
            <div class="warning">
                <strong>Warning:</strong> Never proceed with migration without a verified backup. The migration process is irreversible once data is committed to the new system.
            </div>
        </div>
    </div>

    <div id="extraction" class="section-content">
        <h2>2. Data Extraction from AccuFund</h2>
        
        <div class="step">
            <div class="step-title"><span class="step-number">1</span>Extract Chart of Accounts</div>
            <p>Export your complete chart of accounts from AccuFund.</p>
            <ol>
                <li>In AccuFund, go to <strong>General Ledger > Reports > Chart of Accounts</strong></li>
                <li>Select the option to include all fields</li>
                <li>Choose CSV as the export format</li>
                <li>Save the file as <code>accufund_coa.csv</code></li>
            </ol>
            <p>Ensure the export includes these critical fields:</p>
            <ul>
                <li>Account Code</li>
                <li>Account Name</li>
                <li>Account Type</li>
                <li>Account Status</li>
                <li>Parent Account (if hierarchical)</li>
                <li>Entity/Department</li>
            </ul>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">2</span>Extract Fund Definitions</div>
            <p>Export all fund definitions from AccuFund.</p>
            <ol>
                <li>In AccuFund, go to <strong>General Ledger > Reports > Fund Listing</strong></li>
                <li>Select the option to include all fields</li>
                <li>Choose CSV as the export format</li>
                <li>Save the file as <code>accufund_funds.csv</code></li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">3</span>Extract Journal Entries</div>
            <p>Export all journal entries for the migration period.</p>
            <ol>
                <li>In AccuFund, go to <strong>General Ledger > Reports > Journal Entry Detail</strong></li>
                <li>Set the date range to cover your migration period (typically current fiscal year plus prior year)</li>
                <li>Select the option to include all fields</li>
                <li>Choose CSV as the export format</li>
                <li>Save the file as <code>accufund_journal_entries.csv</code></li>
            </ol>
            <div class="tip">
                <strong>Tip:</strong> If you have a large volume of transactions, consider exporting in smaller batches by date range or fund.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">4</span>Extract Entity Definitions</div>
            <p>If you use multiple entities in AccuFund, export their definitions.</p>
            <ol>
                <li>In AccuFund, go to <strong>Administration > Organization Structure</strong></li>
                <li>Export the organization hierarchy to CSV</li>
                <li>Save the file as <code>accufund_entities.csv</code></li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">5</span>Extract Bank Account Information</div>
            <p>Export all bank account information from AccuFund's Banking module.</p>
            <ol>
                <li>In AccuFund, go to <strong>Administration > Banking > Bank Accounts</strong></li>
                <li>Generate a Bank Accounts Listing report</li>
                <li>Include all fields, especially: Bank Name, Account Name, Account Number, Routing Number, Account Type, Status, and Current Balance</li>
                <li>Export to CSV format</li>
                <li>Save the file as <code>accufund_bank_accounts.csv</code></li>
            </ol>
            <div class="note">
                <strong>Note:</strong> Be sure to capture the Last Reconciled Date for each account to maintain reconciliation history.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">6</span>Extract Balances</div>
            <p>Export current account balances for verification purposes.</p>
            <ol>
                <li>In AccuFund, go to <strong>General Ledger > Reports > Trial Balance</strong></li>
                <li>Set the date to the end of your last closed period</li>
                <li>Export to CSV format</li>
                <li>Save the file as <code>accufund_trial_balance.csv</code></li>
            </ol>
        </div>
    </div>

    <div id="mapping" class="section-content">
        <h2>3. Data Mapping and Transformation</h2>
        
        <div class="step">
            <div class="step-title"><span class="step-number">1</span>Create Entity Mapping</div>
            <p>Map AccuFund entities to the new system's entity structure.</p>
            <ol>
                <li>Create a spreadsheet with columns for AccuFund Entity ID, AccuFund Entity Name, New Entity ID, and New Entity Name</li>
                <li>For each AccuFund entity, determine the corresponding entity in the new system</li>
                <li>Save this mapping as <code>entity_mapping.csv</code></li>
            </ol>
            <p>Example mapping table:</p>
            <table>
                <tr>
                    <th>AccuFund Entity ID</th>
                    <th>AccuFund Entity Name</th>
                    <th>New Entity ID</th>
                    <th>New Entity Name</th>
                </tr>
                <tr>
                    <td>MAIN</td>
                    <td>Main Organization</td>
                    <td>TPF_PARENT</td>
                    <td>The Principle Foundation</td>
                </tr>
                <tr>
                    <td>EDU</td>
                    <td>Education Division</td>
                    <td>TPF-ES</td>
                    <td>TPF Educational Services</td>
                </tr>
            </table>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">2</span>Create Account Mapping</div>
            <p>Map AccuFund accounts to the new system's chart of accounts.</p>
            <ol>
                <li>Create a spreadsheet with columns for AccuFund Account Code, AccuFund Account Name, New Account Code, New Account Name, and Account Type</li>
                <li>For each AccuFund account, determine the corresponding account in the new system</li>
                <li>Save this mapping as <code>account_mapping.csv</code></li>
            </ol>
            <div class="note">
                <strong>Note:</strong> Pay special attention to account types, as they might be categorized differently in the new system.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">3</span>Create Fund Mapping</div>
            <p>Map AccuFund funds to the new system's fund structure.</p>
            <ol>
                <li>Create a spreadsheet with columns for AccuFund Fund Code, AccuFund Fund Name, New Fund Code, New Fund Name, and Fund Type</li>
                <li>For each AccuFund fund, determine the corresponding fund in the new system</li>
                <li>Save this mapping as <code>fund_mapping.csv</code></li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">4</span>Create Bank Account Mapping</div>
            <p>Map AccuFund bank accounts to the new system's bank_accounts table structure.</p>
            <ol>
                <li>Create a spreadsheet with the following columns to match the v9.0+ bank_accounts table:
                    <ul>
                        <li>bank_name</li>
                        <li>account_name</li>
                        <li>account_number</li>
                        <li>routing_number</li>
                        <li>type (map to: "Checking", "Savings", "Credit Card", etc.)</li>
                        <li>status ("Active" or "Inactive")</li>
                        <li>balance (current balance as of migration date)</li>
                        <li>connection_method (default to "Manual" for initial import)</li>
                        <li>description</li>
                    </ul>
                </li>
                <li>For each AccuFund bank account, map the information to the corresponding fields</li>
                <li>Save this mapping as <code>bank_account_mapping.csv</code></li>
            </ol>
            <div class="tip">
                <strong>Tip:</strong> Include the GL account code that corresponds to each bank account to ensure proper reconciliation with the chart of accounts.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">5</span>Transform Journal Entry Data</div>
            <p>Process the journal entry data to match the new system's format.</p>
            <ol>
                <li>Create a script to process the journal entries CSV file</li>
                <li>Apply the entity, account, and fund mappings to transform the data</li>
                <li>Format dates to match the new system's requirements (YYYY-MM-DD)</li>
                <li>Split the data into two files:
                    <ul>
                        <li><code>journal_entries.csv</code> - Header information for each journal entry</li>
                        <li><code>journal_entry_lines.csv</code> - Line items for each journal entry</li>
                    </ul>
                </li>
            </ol>
            <div class="code-block">
                # Example Python script for transforming journal entries<br>
                import pandas as pd<br>
                import uuid<br><br>
                
                # Load mappings<br>
                entity_mapping = pd.read_csv('entity_mapping.csv')<br>
                account_mapping = pd.read_csv('account_mapping.csv')<br>
                fund_mapping = pd.read_csv('fund_mapping.csv')<br><br>
                
                # Load journal entries<br>
                journal_data = pd.read_csv('accufund_journal_entries.csv')<br><br>
                
                # Apply mappings and transformations<br>
                # [Transformation logic here]<br><br>
                
                # Save transformed data<br>
                journal_entries.to_csv('journal_entries.csv', index=False)<br>
                journal_entry_lines.to_csv('journal_entry_lines.csv', index=False)
            </div>
        </div>
    </div>

    <div id="inter-entity" class="section-content">
        <h2>4. Inter-Entity Transfer Migration (v9.0)</h2>
        
        <div class="step">
            <div class="step-title"><span class="step-number">1</span>Identify Inter-Entity Transactions</div>
            <p>Identify all transactions in AccuFund that represent transfers between entities.</p>
            <ol>
                <li>Review your journal entries for transactions that involve multiple entities</li>
                <li>Look for accounts with names like "Due To" or "Due From"</li>
                <li>Create a list of all inter-entity transaction pairs</li>
                <li>Save this list as <code>inter_entity_transactions.csv</code></li>
            </ol>
            <div class="tip">
                <strong>Tip:</strong> In AccuFund, you can often identify these by running a report filtered on inter-company accounts or by specific transaction types used for inter-entity transfers.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">2</span>Map Due To/Due From Accounts</div>
            <p>Ensure proper mapping of Due To/Due From accounts to support the inter-entity transfer feature.</p>
            <ol>
                <li>Identify all Due To/Due From accounts in AccuFund</li>
                <li>Create or identify corresponding accounts in the new system following the required structure:
                    <ul>
                        <li>Asset accounts (19xx series) for "Due From" relationships</li>
                        <li>Liability accounts (29xx series) for "Due To" relationships</li>
                    </ul>
                </li>
                <li>Update your account mapping to include these specialized accounts</li>
            </ol>
            <div class="note">
                <strong>Note:</strong> The v9.0 Inter-Entity Transfer feature requires specific account structures. Each entity should have:
                <ul>
                    <li>One "Due From" account (Asset, 19xx) for each counter-party entity</li>
                    <li>One "Due To" account (Liability, 29xx) for each counter-party entity</li>
                </ul>
            </div>
            <p>Example naming convention:</p>
            <table>
                <tr>
                    <th>Entity</th>
                    <th>Account Type</th>
                    <th>Account Code</th>
                    <th>Account Name</th>
                </tr>
                <tr>
                    <td>TPF</td>
                    <td>Asset</td>
                    <td>1901</td>
                    <td>Due From TPF-ES</td>
                </tr>
                <tr>
                    <td>TPF-ES</td>
                    <td>Liability</td>
                    <td>2901</td>
                    <td>Due To TPF</td>
                </tr>
            </table>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">3</span>Transform Inter-Entity Transactions</div>
            <p>Process inter-entity transactions to match the new system's format.</p>
            <ol>
                <li>Create a script to identify and pair related inter-entity transactions</li>
                <li>Generate a unique <code>matching_transaction_id</code> for each pair</li>
                <li>Set the <code>is_inter_entity</code> flag to true for these transactions</li>
                <li>Set the <code>target_entity_id</code> field to the appropriate entity</li>
                <li>Update the transformed journal entries data with this information</li>
            </ol>
            <div class="code-block">
                # Example Python code for processing inter-entity transactions<br>
                import uuid<br><br>
                
                # For each pair of inter-entity transactions<br>
                for transaction_pair in inter_entity_pairs:<br>
                &nbsp;&nbsp;# Generate a shared matching transaction ID<br>
                &nbsp;&nbsp;matching_id = str(uuid.uuid4())<br><br>
                
                &nbsp;&nbsp;# Update source transaction<br>
                &nbsp;&nbsp;source_tx = journal_entries[journal_entries['id'] == transaction_pair['source_id']]<br>
                &nbsp;&nbsp;source_tx['is_inter_entity'] = True<br>
                &nbsp;&nbsp;source_tx['target_entity_id'] = transaction_pair['target_entity_id']<br>
                &nbsp;&nbsp;source_tx['matching_transaction_id'] = matching_id<br><br>
                
                &nbsp;&nbsp;# Update target transaction<br>
                &nbsp;&nbsp;target_tx = journal_entries[journal_entries['id'] == transaction_pair['target_id']]<br>
                &nbsp;&nbsp;target_tx['is_inter_entity'] = True<br>
                &nbsp;&nbsp;target_tx['target_entity_id'] = transaction_pair['source_entity_id']<br>
                &nbsp;&nbsp;target_tx['matching_transaction_id'] = matching_id
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">4</span>Handle Single-Entry Inter-Entity Transactions</div>
            <p>If AccuFund recorded inter-entity transfers as single entries, split them into paired transactions.</p>
            <ol>
                <li>Identify transactions that affect multiple entities but are recorded as single entries</li>
                <li>Split each into two separate journal entries:
                    <ul>
                        <li>One for the source entity (with "Due From" account)</li>
                        <li>One for the target entity (with "Due To" account)</li>
                    </ul>
                </li>
                <li>Link the pair with a common <code>matching_transaction_id</code></li>
                <li>Set the <code>is_inter_entity</code> flag to true for both entries</li>
                <li>Set the appropriate <code>target_entity_id</code> for each entry</li>
            </ol>
            <div class="warning">
                <strong>Warning:</strong> This step is critical for maintaining proper inter-entity relationships. Single-entry transactions must be split to work with the v9.0 Inter-Entity Transfer feature.
            </div>
        </div>
    </div>

    <div id="validation" class="section-content">
        <h2>5. Data Validation</h2>
        
        <div class="step">
            <div class="step-title"><span class="step-number">1</span>Validate Chart of Accounts</div>
            <p>Verify the transformed chart of accounts for completeness and accuracy.</p>
            <ol>
                <li>Check that all accounts from AccuFund have been mapped</li>
                <li>Verify that account types are correctly assigned</li>
                <li>Ensure that parent-child relationships are preserved</li>
                <li>Confirm that entity associations are correct</li>
            </ol>
            <div class="command">
                # Example validation query<br>
                SELECT COUNT(*) FROM accounts;<br>
                # Compare with the count from AccuFund
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">2</span>Validate Fund Structure</div>
            <p>Verify the transformed fund structure for completeness and accuracy.</p>
            <ol>
                <li>Check that all funds from AccuFund have been mapped</li>
                <li>Verify that fund types are correctly assigned</li>
                <li>Confirm that entity associations are correct</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">3</span>Validate Bank Account Data</div>
            <p>Verify the transformed bank account data for completeness and accuracy.</p>
            <ol>
                <li>Check that all bank accounts from AccuFund have been mapped</li>
                <li>Verify that account types are correctly assigned (Checking, Savings, Credit Card, etc.)</li>
                <li>Ensure that account numbers and routing numbers are correctly formatted</li>
                <li>Confirm that opening balances match the balances in AccuFund as of the migration date</li>
            </ol>
            <div class="tip">
                <strong>Tip:</strong> Pay special attention to bank accounts that have pending reconciliations or outstanding transactions.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">4</span>Validate Journal Entries</div>
            <p>Verify the transformed journal entries for completeness and accuracy.</p>
            <ol>
                <li>Check that the total number of journal entries matches AccuFund</li>
                <li>Verify that debits equal credits for each journal entry</li>
                <li>Confirm that dates, amounts, and descriptions are preserved</li>
                <li>Check that account and fund references are correctly mapped</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">5</span>Validate Inter-Entity Relationships</div>
            <p>Verify that inter-entity transactions are correctly configured.</p>
            <ol>
                <li>Check that all inter-entity transactions have been identified and paired</li>
                <li>Verify that each pair shares the same <code>matching_transaction_id</code></li>
                <li>Confirm that <code>is_inter_entity</code> flags are set correctly</li>
                <li>Verify that <code>target_entity_id</code> fields are correctly cross-referenced</li>
                <li>Ensure that Due To/Due From accounts are used appropriately</li>
            </ol>
            <div class="tip">
                <strong>Tip:</strong> Create a validation report that shows each pair of inter-entity transactions side by side to verify they balance correctly.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">6</span>Validate Balances</div>
            <p>Verify that account balances match between AccuFund and the transformed data.</p>
            <ol>
                <li>Calculate ending balances for all accounts using the transformed journal entries</li>
                <li>Compare these with the trial balance exported from AccuFund</li>
                <li>Investigate and resolve any discrepancies</li>
            </ol>
            <div class="code-block">
                # Example SQL to calculate account balances<br>
                SELECT<br>
                &nbsp;&nbsp;a.id,<br>
                &nbsp;&nbsp;a.code,<br>
                &nbsp;&nbsp;a.name,<br>
                &nbsp;&nbsp;COALESCE(SUM(jel.debit_amount), 0) AS total_debits,<br>
                &nbsp;&nbsp;COALESCE(SUM(jel.credit_amount), 0) AS total_credits,<br>
                &nbsp;&nbsp;COALESCE(SUM(jel.debit_amount - jel.credit_amount), 0) AS balance<br>
                FROM accounts a<br>
                LEFT JOIN journal_entry_lines jel ON jel.account_id = a.id<br>
                GROUP BY a.id, a.code, a.name<br>
                ORDER BY a.code;
            </div>
        </div>
    </div>

    <div id="import" class="section-content">
        <h2>6. Data Import Process</h2>
        
        <div class="step">
            <div class="step-title"><span class="step-number">1</span>Initialize the Database Schema</div>
            <p>Set up the database schema in the new system.</p>
            <ol>
                <li>Start the application to initialize the database schema:</li>
                <div class="command">
                    cd nonprofit-fund-accounting<br>
                    npm start
                </div>
                <li>Verify that the database tables have been created:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "\dt"
                </div>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">2</span>Import Entities</div>
            <p>Import the entity structure into the new system.</p>
            <ol>
                <li>Prepare the entities data in the required format</li>
                <li>Import the entities using the provided script:</li>
                <div class="command">
                    node add-tpf-hierarchy.js
                </div>
                <li>Verify the entities were imported correctly:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "SELECT * FROM entities ORDER BY code"
                </div>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">3</span>Import Chart of Accounts</div>
            <p>Import the chart of accounts into the new system.</p>
            <ol>
                <li>Use the AccuFund import utility to import the accounts:</li>
                <div class="command">
                    # Open the import utility in your browser<br>
                    open http://localhost:3000/accufund-import.html
                </div>
                <li>Upload the transformed <code>accounts.csv</code> file</li>
                <li>Map the columns as prompted</li>
                <li>Validate and import the data</li>
                <li>Verify the accounts were imported correctly:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "SELECT COUNT(*) FROM accounts"
                </div>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">4</span>Import Funds</div>
            <p>Import the fund structure into the new system.</p>
            <ol>
                <li>Use the AccuFund import utility to import the funds:</li>
                <div class="command">
                    # Open the import utility in your browser<br>
                    open http://localhost:3000/accufund-import.html
                </div>
                <li>Upload the transformed <code>funds.csv</code> file</li>
                <li>Map the columns as prompted</li>
                <li>Validate and import the data</li>
                <li>Verify the funds were imported correctly:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "SELECT COUNT(*) FROM funds"
                </div>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">5</span>Import Bank Accounts</div>
            <p>Import the bank accounts into the new system.</p>
            <ol>
                <li>Use the AccuFund import utility to import the bank accounts:</li>
                <div class="command">
                    # Open the import utility in your browser<br>
                    open http://localhost:3000/accufund-import.html
                </div>
                <li>Select "Bank Accounts" as the target table</li>
                <li>Upload the transformed <code>bank_account_mapping.csv</code> file</li>
                <li>Map the columns as prompted, ensuring all required fields are mapped correctly</li>
                <li>Validate and import the data</li>
                <li>Verify the bank accounts were imported correctly:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "SELECT * FROM bank_accounts ORDER BY bank_name, account_name"
                </div>
            </ol>
            <div class="note">
                <strong>Note:</strong> The Bank Account Management module in v9.0+ requires proper setup of bank accounts to enable reconciliation and transaction matching features.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">6</span>Import Journal Entries</div>
            <p>Import the journal entries into the new system.</p>
            <ol>
                <li>Import the journal entry headers:</li>
                <div class="command">
                    # Using the COPY command for bulk import<br>
                    psql -U postgres -d fund_accounting_db -c "\COPY journal_entries FROM 'journal_entries.csv' WITH CSV HEADER"
                </div>
                <li>Import the journal entry lines:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "\COPY journal_entry_lines FROM 'journal_entry_lines.csv' WITH CSV HEADER"
                </div>
                <li>Verify the journal entries were imported correctly:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "SELECT COUNT(*) FROM journal_entries"<br>
                    psql -U postgres -d fund_accounting_db -c "SELECT COUNT(*) FROM journal_entry_lines"
                </div>
            </ol>
            <div class="warning">
                <strong>Warning:</strong> Journal entry import can be time-consuming for large datasets. Consider importing in batches if you have a very large number of transactions.
            </div>
        </div>
    </div>

    <div id="verification" class="section-content">
        <h2>7. Post-Migration Verification</h2>
        
        <div class="step">
            <div class="step-title"><span class="step-number">1</span>Verify Entity Structure</div>
            <p>Confirm that the entity structure has been correctly imported.</p>
            <ol>
                <li>Navigate to <strong>Settings > Entities</strong> in the application</li>
                <li>Verify that all entities are present and correctly organized</li>
                <li>Check parent-child relationships</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">2</span>Verify Chart of Accounts</div>
            <p>Confirm that the chart of accounts has been correctly imported.</p>
            <ol>
                <li>Navigate to <strong>Chart of Accounts</strong> in the application</li>
                <li>Verify that all accounts are present and correctly categorized</li>
                <li>Check account types and entity associations</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">3</span>Verify Fund Structure</div>
            <p>Confirm that the fund structure has been correctly imported.</p>
            <ol>
                <li>Navigate to <strong>Funds</strong> in the application</li>
                <li>Verify that all funds are present and correctly categorized</li>
                <li>Check fund types and entity associations</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">4</span>Verify Bank Accounts</div>
            <p>Confirm that the bank accounts have been correctly imported.</p>
            <ol>
                <li>Navigate to <strong>Bank Accounts</strong> in the application</li>
                <li>Verify that all bank accounts are present with correct information</li>
                <li>Check account types, balances, and status</li>
                <li>Perform a test reconciliation on one bank account to ensure the feature works properly</li>
                <li>Verify that each bank account is properly linked to its corresponding GL account</li>
            </ol>
            <div class="tip">
                <strong>Tip:</strong> The Bank Account Management module added in v9.0 provides a comprehensive reconciliation workflow. Test this feature with a sample bank statement to ensure it works as expected.
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">5</span>Verify Financial Reports</div>
            <p>Generate key financial reports and compare with AccuFund.</p>
            <ol>
                <li>Generate a Trial Balance report in both systems</li>
                <li>Generate a Balance Sheet report in both systems</li>
                <li>Generate an Income Statement report in both systems</li>
                <li>Compare the reports and investigate any discrepancies</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">6</span>Verify Inter-Entity Transfers</div>
            <p>Confirm that inter-entity transfers have been correctly imported and are functioning as expected.</p>
            <ol>
                <li>Navigate to <strong>Reports</strong> and run the Inter-Entity Transfers report</li>
                <li>Verify that all expected transfer pairs are present and correctly linked</li>
                <li>Check that Due To and Due From balances match between entities</li>
                <li>Test the Inter-Entity Transfer Wizard to create a new transfer:
                    <ul>
                        <li>Navigate to <strong>Inter-Entity Transfer</strong> in the main menu</li>
                        <li>Create a test transfer between two entities</li>
                        <li>Verify that both journal entries are created correctly</li>
                        <li>Verify that the entries are linked with a matching transaction ID</li>
                    </ul>
                </li>
            </ol>
            <div class="tip">
                <strong>Tip:</strong> Run the following query to verify that inter-entity transfers are balanced:
                <div class="code-block">
                    SELECT<br>
                    &nbsp;&nbsp;e1.name AS source_entity,<br>
                    &nbsp;&nbsp;e2.name AS target_entity,<br>
                    &nbsp;&nbsp;je1.matching_transaction_id,<br>
                    &nbsp;&nbsp;je1.total_amount AS source_amount,<br>
                    &nbsp;&nbsp;je2.total_amount AS target_amount<br>
                    FROM journal_entries je1<br>
                    JOIN journal_entries je2 ON je1.matching_transaction_id = je2.matching_transaction_id AND je1.id != je2.id<br>
                    JOIN entities e1 ON je1.entity_id = e1.id<br>
                    JOIN entities e2 ON je2.entity_id = e2.id<br>
                    WHERE je1.is_inter_entity = true<br>
                    ORDER BY je1.entry_date;
                </div>
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">7</span>User Acceptance Testing</div>
            <p>Have key users test the system to verify functionality.</p>
            <ol>
                <li>Create a test plan covering key workflows</li>
                <li>Have users execute the test plan and document results</li>
                <li>Address any issues identified during testing</li>
                <li>Get formal sign-off from key stakeholders</li>
            </ol>
            <div class="note">
                <strong>Note:</strong> This is a critical step before going live with the new system. Ensure that all key users are involved in testing.
            </div>
        </div>
    </div>

    <div id="troubleshooting" class="section-content">
        <h2>8. Troubleshooting Common Issues</h2>
        
        <div class="step">
            <div class="step-title"><span class="step-number">1</span>Unbalanced Journal Entries</div>
            <p>If journal entries are not balanced (debits don't equal credits):</p>
            <ol>
                <li>Identify the unbalanced entries:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "SELECT je.id, je.reference_number, je.entry_date, SUM(jel.debit_amount) as total_debits, SUM(jel.credit_amount) as total_credits, SUM(jel.debit_amount) - SUM(jel.credit_amount) as difference FROM journal_entries je JOIN journal_entry_lines jel ON je.id = jel.journal_entry_id GROUP BY je.id, je.reference_number, je.entry_date HAVING ABS(SUM(jel.debit_amount) - SUM(jel.credit_amount)) > 0.01 ORDER BY je.entry_date"
                </div>
                <li>Check the original AccuFund data for these entries</li>
                <li>Fix the imbalances by adding missing lines or correcting amounts</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">2</span>Missing Accounts or Funds</div>
            <p>If accounts or funds are missing after import:</p>
            <ol>
                <li>Compare the counts between AccuFund and the new system</li>
                <li>Identify the specific missing items</li>
                <li>Check your mapping files for omissions</li>
                <li>Import the missing items manually</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">3</span>Inter-Entity Transfer Issues</div>
            <p>If inter-entity transfers are not working correctly:</p>
            <ol>
                <li>Check that Due To/Due From accounts are properly set up with the correct naming and numbering conventions (19xx for assets, 29xx for liabilities)</li>
                <li>Verify that each pair of transactions has the same <code>matching_transaction_id</code></li>
                <li>Confirm that <code>is_inter_entity</code> is set to true for both transactions</li>
                <li>Ensure that <code>target_entity_id</code> is correctly cross-referenced</li>
                <li>Verify that the entities exist and are correctly configured</li>
            </ol>
            <div class="code-block">
                # Fix missing matching_transaction_id<br>
                UPDATE journal_entries<br>
                SET matching_transaction_id = 'generated-uuid-here'<br>
                WHERE id IN ('entry1-id', 'entry2-id');
            </div>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">4</span>Balance Discrepancies</div>
            <p>If account balances don't match between AccuFund and the new system:</p>
            <ol>
                <li>Generate detailed transaction reports for the affected accounts in both systems</li>
                <li>Compare the transactions line by line to identify differences</li>
                <li>Check for missing transactions, incorrect amounts, or misclassifications</li>
                <li>Make corrections as needed</li>
            </ol>
        </div>

        <div class="step">
            <div class="step-title"><span class="step-number">5</span>Performance Issues</div>
            <p>If the system is slow after migration:</p>
            <ol>
                <li>Check database indexes:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "\di"
                </div>
                <li>Add missing indexes where needed:</li>
                <div class="command">
                    psql -U postgres -d fund_accounting_db -c "CREATE INDEX idx_journal_entries_entry_date ON journal_entries(entry_date)"
                </div>
                <li>Optimize database queries in the application code</li>
                <li>Consider archiving older transactions if volume is very large</li>
            </ol>
        </div>
    </div>

    <div class="section-content">
        <h2>Conclusion</h2>
        <p>Following this step-by-step guide should result in a successful migration from AccuFund to the Nonprofit Fund Accounting System v9.0. The process requires careful planning, thorough validation, and attention to detail, especially for inter-entity transfers and bank account management.</p>
        
        <p>After completing the migration, be sure to:</p>
        <ul>
            <li>Train all users on the new system</li>
            <li>Document any customizations or special configurations</li>
            <li>Establish regular backup procedures</li>
            <li>Keep the AccuFund data accessible for historical reference</li>
        </ul>
        
        <p>For additional assistance, refer to the Administrator's Guide and User Guide for detailed information on using the system.</p>
    </div>

    <div class="footer">
        <p>Generated by Droid by FACTORY on <script>document.write(new Date().toLocaleDateString());</script></p>
    </div>
</body>
</html>
