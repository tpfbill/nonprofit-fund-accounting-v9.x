<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VirtualBox Ubuntu 24.04 Installation Guide v9.0</title>
    <style>
        /* Print-specific styles */
        @page {
            size: letter;
            margin: 1in 0.75in;
        }
        
        @media print {
            .page-break {
                page-break-before: always;
            }
            
            thead {
                display: table-header-group;
            }
            
            tfoot {
                display: table-footer-group;
            }
            
            body {
                margin: 0;
                padding: 0;
            }
            
            a {
                text-decoration: none;
                color: #000;
            }
            
            .no-print {
                display: none;
            }
            
            /* Print header and footer on each page */
            @page {
                @top-center {
                    content: "Non-Profit Fund Accounting System v9.0";
                }
                @bottom-center {
                    content: "Page " counter(page) " of " counter(pages);
                }
                @bottom-right {
                    content: "July 22, 2025";
                }
            }
        }
        
        /* General styles */
        body {
            font-family: Arial, Helvetica, sans-serif;
            line-height: 1.5;
            color: #333;
            margin: 0;
            padding: 0 20px;
            max-width: 8.5in;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2em;
            padding-bottom: 1em;
            border-bottom: 2px solid #2c5aa0;
        }
        
        .header h1 {
            color: #2c5aa0;
            font-size: 24pt;
            margin-bottom: 0.2em;
        }
        
        .header h2 {
            color: #555;
            font-size: 18pt;
            font-weight: normal;
            margin-top: 0;
        }
        
        .header .date {
            color: #777;
            font-size: 12pt;
            margin-top: 1em;
        }
        
        /* Table of Contents */
        .toc {
            margin: 2em 0 3em 0;
        }
        
        .toc h2 {
            color: #2c5aa0;
            font-size: 16pt;
            margin-bottom: 1em;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.3em;
        }
        
        .toc ul {
            list-style-type: none;
            padding: 0;
        }
        
        .toc li {
            margin-bottom: 0.5em;
            display: flex;
        }
        
        .toc-item {
            flex-grow: 1;
        }
        
        .toc-dots {
            flex-grow: 1;
            border-bottom: 1px dotted #ccc;
            margin: 0 5px;
            position: relative;
            top: -5px;
        }
        
        /* Headings */
        h1, h2, h3, h4 {
            color: #2c5aa0;
            page-break-after: avoid;
        }
        
        h1 {
            font-size: 18pt;
            margin-top: 2em;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.3em;
        }
        
        h2 {
            font-size: 16pt;
            margin-top: 1.5em;
        }
        
        h3 {
            font-size: 14pt;
            margin-top: 1.2em;
        }
        
        /* Code blocks */
        code, pre {
            font-family: 'Courier New', monospace;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        code {
            padding: 2px 5px;
            font-size: 90%;
        }
        
        pre {
            padding: 10px;
            overflow-x: auto;
            line-height: 1.4;
            margin: 1em 0;
            white-space: pre-wrap;
            page-break-inside: avoid;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
            page-break-inside: avoid;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        /* Special sections */
        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            page-break-inside: avoid;
        }
        
        .note {
            background-color: #e8f4f8;
            border-left: 4px solid #5bc0de;
            padding: 15px;
            margin: 15px 0;
            page-break-inside: avoid;
        }
        
        .architecture {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-style: italic;
            page-break-inside: avoid;
        }
        
        .section-divider {
            border-top: 1px solid #eee;
            margin: 30px 0;
        }
        
        /* Links */
        a {
            color: #2c5aa0;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        /* Lists */
        ul, ol {
            margin: 15px 0;
            padding-left: 25px;
        }
        
        li {
            margin-bottom: 5px;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            color: #777;
            font-size: 10pt;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }
        
        /* Conclusion */
        .conclusion {
            margin-top: 40px;
            font-style: italic;
            text-align: center;
            color: #555;
            page-break-inside: avoid;
        }
        
        /* Print button (only visible in screen mode) */
        .print-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #2c5aa0;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            z-index: 1000;
        }
        
        @media print {
            .print-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <button class="print-button no-print" onclick="window.print()">Print to PDF</button>
    
    <div class="header">
        <h1>Non-Profit Fund Accounting System v9.0</h1>
        <h2>Installation Guide – VirtualBox on Windows 11 (Ubuntu 24.04 LTS Guest)</h2>
        <div class="date">July 22, 2025</div>
    </div>
    
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li>
                <span class="toc-item">1. Prerequisites & Host Requirements</span>
                <span class="toc-dots"></span>
                <span class="toc-page">1</span>
            </li>
            <li>
                <span class="toc-item">2. VirtualBox VM Setup & Ubuntu 24.04 Installation</span>
                <span class="toc-dots"></span>
                <span class="toc-page">2</span>
            </li>
            <li>
                <span class="toc-item">3. Install Prerequisite Packages</span>
                <span class="toc-dots"></span>
                <span class="toc-page">3</span>
            </li>
            <li>
                <span class="toc-item">4. Clone Application & Prepare Environment</span>
                <span class="toc-dots"></span>
                <span class="toc-page">4</span>
            </li>
            <li>
                <span class="toc-item">5. Database Configuration & Initialization</span>
                <span class="toc-dots"></span>
                <span class="toc-page">5</span>
            </li>
            <li>
                <span class="toc-item">6. Running the Application</span>
                <span class="toc-dots"></span>
                <span class="toc-page">6</span>
            </li>
            <li>
                <span class="toc-item">7. Testing Checklist (v9.0)</span>
                <span class="toc-dots"></span>
                <span class="toc-page">7</span>
            </li>
            <li>
                <span class="toc-item">8. Troubleshooting</span>
                <span class="toc-dots"></span>
                <span class="toc-page">8</span>
            </li>
            <li>
                <span class="toc-item">9. Performance Tips</span>
                <span class="toc-dots"></span>
                <span class="toc-page">8</span>
            </li>
            <li>
                <span class="toc-item">10. Security Notes</span>
                <span class="toc-dots"></span>
                <span class="toc-page">9</span>
            </li>
            <li>
                <span class="toc-item">Appendix A – Useful Commands</span>
                <span class="toc-dots"></span>
                <span class="toc-page">9</span>
            </li>
        </ul>
    </div>
    
    <div class="architecture">
        <strong>Architecture overview</strong><br>
        • <strong>Host OS:</strong> Windows 11 (runs Oracle VM VirtualBox)<br>
        • <strong>Guest OS:</strong> Ubuntu Desktop 24.04 inside the VM<br>
        • <strong>Application:</strong> Non-Profit Fund Accounting System v9.0 installed in <code>/opt/nonprofit-fund-accounting</code>
    </div>
    
    <div class="page-break"></div>
    
    <h1>1. Prerequisites & Host Requirements</h1>
    
    <table>
        <thead>
            <tr>
                <th>Host requirement</th>
                <th>Minimum</th>
                <th>Recommended</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Host OS</td>
                <td>Windows 10/11</td>
                <td>—</td>
            </tr>
            <tr>
                <td>CPU</td>
                <td>4 cores (VT-x/AMD-V)</td>
                <td>6+ cores</td>
            </tr>
            <tr>
                <td>RAM</td>
                <td>8 GB</td>
                <td>16 GB (allocate ≥ 6 GB to guest)</td>
            </tr>
            <tr>
                <td>Disk space</td>
                <td>40 GB free</td>
                <td>80 GB SSD/NVMe</td>
            </tr>
            <tr>
                <td>Software</td>
                <td>Oracle VirtualBox ≥ 7.0, Ubuntu 24.04 ISO</td>
                <td>—</td>
            </tr>
        </tbody>
    </table>
    
    <div class="warning">
        <strong>⚠️ Important:</strong> Enable hardware virtualization (Intel VT-x/AMD-V) in BIOS/UEFI before proceeding.
    </div>
    
    <div class="section-divider"></div>
    
    <h1>2. VirtualBox VM Setup & Ubuntu 24.04 Installation</h1>
    
    <ol>
        <li>
            <strong>Download</strong><br>
            • VirtualBox: <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a><br>
            • Ubuntu 24.04 ISO: <a href="https://ubuntu.com/download/desktop">https://ubuntu.com/download/desktop</a>
        </li>
        <li>
            <strong>Create a new VM</strong><br>
            - Name: <code>Ubuntu24-FundAcct-v9_0</code><br>
            - Type: <em>Linux</em> → version <em>Ubuntu (64-bit)</em><br>
            - Memory: <strong>6144 MB</strong><br>
            - Processors: <strong>4 vCPU</strong> (System ➜ Processor)<br>
            - Disk: <strong>VDI</strong>, dynamically allocated, <strong>60 GB</strong>
        </li>
        <li>
            <strong>Adjust settings</strong><br>
            - Display ➜ Graphics Controller: <strong>VBoxSVGA</strong>, enable <strong>3D Acceleration</strong><br>
            - Storage ➜ Empty optical drive → <strong>Choose a disk file…</strong> select Ubuntu ISO<br>
            - Network Adapter 1: <strong>Bridged</strong> <em>or</em> <strong>NAT</strong> (either works)
        </li>
        <li>
            <strong>Install Ubuntu 24.04</strong> inside the VM<br>
            - "Normal installation", enable third-party software (optional)<br>
            - Disk setup: <strong>Use entire disk</strong> with <strong>LVM</strong> (default)<br>
            - Username: <strong>fundadmin</strong> (sudo)<br>
            - Reboot, login, run <code>Software Updater</code>
        </li>
    </ol>
    
    <div class="page-break"></div>
    
    <h1>3. Install Prerequisite Packages</h1>
    
    <pre>
# Update system
sudo apt update && sudo apt -y upgrade

# Essential tools
sudo apt install -y git build-essential curl

# Node.js 20 LTS
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# PostgreSQL 16
echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" | \
  sudo tee /etc/apt/sources.list.d/pgdg.list
curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo apt update
sudo apt install -y postgresql-16

# Verify versions
node -v    # v20.x
npm  -v    # 10.x+
psql -V    # 16.x
</pre>
    
    <div class="section-divider"></div>
    
    <h1>4. Clone Application & Prepare Environment</h1>
    
    <pre>
sudo mkdir -p /opt && cd /opt
sudo git clone https://github.com/tpfbill/nonprofit-fund-accounting.git
sudo chown -R $USER:$USER nonprofit-fund-accounting
cd nonprofit-fund-accounting
</pre>
    
    <p>Create <code>.env</code>:</p>
    
    <pre>
PGHOST=localhost
PGPORT=5432
PGDATABASE=fund_accounting_db
PGUSER=npfadmin
PGPASSWORD=npfa123
PORT=3000
</pre>
    
    <p>Install dependencies:</p>
    
    <pre>
npm ci
</pre>
    
    <div class="page-break"></div>
    
    <h1>5. Database Configuration & Initialization</h1>
    
    <h2>5.1 One-step Role & Database Setup</h2>
    
    <p>Run the cross-platform helper script – it creates the <strong>npfadmin</strong> role, database, grants, and verifies connectivity in one go:</p>
    
    <pre>
sudo -u postgres psql -f database/setup-database-cross-platform.sql
</pre>
    
    <h2>5.2 Load Base Schema</h2>
    
    <pre>
sudo -u postgres psql -d fund_accounting_db -f database/db-init.sql
</pre>
    
    <p><code>database/db-init.sql</code> now contains <strong>all</strong> required tables and columns – no manual <code>ALTER</code> steps needed.</p>
    
    <h2>5.3 NACHA Vendor Payments Schema (v9.0)</h2>
    
    <pre>
sudo -u postgres psql -d fund_accounting_db -f database/nacha-vendor-payments-schema.sql
</pre>
    
    <p>This adds <code>vendors</code>, <code>vendor_bank_accounts</code>, <code>payment_batches</code>, <code>payment_items</code>, <code>company_nacha_settings</code>, and <code>nacha_files</code>.</p>
    
    <h2>5.4 (Optional) Load Demo Data</h2>
    
    <pre>
node database/load-principle-foundation-data.js
</pre>
    
    <p>Creates The Principle Foundation multi-entity hierarchy with sample funds, accounts, and transactions.</p>
    
    <div class="page-break"></div>
    
    <h1>6. Running the Application</h1>
    
    <p>Open <strong>two terminals</strong> inside the VM:</p>
    
    <pre>
# Terminal 1 – backend API on port 3000
cd /opt/nonprofit-fund-accounting
node server.js
</pre>
    
    <pre>
# Terminal 2 – static frontend on port 8080
cd /opt/nonprofit-fund-accounting
npx http-server . -p 8080 --no-cache
</pre>
    
    <p><strong>Alternative (single-command) approach</strong><br>
    The project's <em>package.json</em> ships with helper scripts that can save time:</p>
    
    <pre>
# Start only the static frontend (port 8080)
npm run client

# OR start both backend (port 3000) and frontend (port 8080) concurrently
npm run dev
</pre>
    
    <p>Using <code>npm run dev</code> is handy during active development because it launches both services in the background and streams their combined output.</p>
    
    <p>Browse to <strong>http://localhost:8080/index.html</strong> (from within the VM or via host browser if using bridged network).</p>
    
    <div class="page-break"></div>
    
    <h1>7. Testing Checklist (v9.0)</h1>
    
    <table>
        <thead>
            <tr>
                <th>Test</th>
                <th>Steps</th>
                <th>Expected Outcome</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Dashboard</td>
                <td>Open <code>/index.html</code></td>
                <td>Summary cards & charts display</td>
            </tr>
            <tr>
                <td>Vendor Directory</td>
                <td><code>Vendor Payments ➜ Vendors</code></td>
                <td>Vendors list loads, "Add Vendor" opens modal</td>
            </tr>
            <tr>
                <td>Payment Batch</td>
                <td><code>Vendor Payments ➜ Batches ➜ New Batch</code></td>
                <td>Entity & Fund dropdowns populate immediately</td>
            </tr>
            <tr>
                <td>NACHA File</td>
                <td>Create batch ➜ approve ➜ <em>Generate NACHA</em></td>
                <td><code>.ACH</code> file appears in <strong>Files</strong> tab and downloads</td>
            </tr>
            <tr>
                <td>API Health</td>
                <td><code>curl http://localhost:3000/api/health</code></td>
                <td><code>{"status":"ok"}</code></td>
            </tr>
            <tr>
                <td>Documentation Tab</td>
                <td>Click <strong>Documentation</strong></td>
                <td><code>direct-docs.html</code> opens without styling issues</td>
            </tr>
        </tbody>
    </table>
    
    <div class="section-divider"></div>
    
    <h1>8. Troubleshooting</h1>
    
    <table>
        <thead>
            <tr>
                <th>Symptom</th>
                <th>Fix</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>"DB offline" badge</td>
                <td><code>sudo systemctl restart postgresql</code> and verify <code>.env</code> creds</td>
            </tr>
            <tr>
                <td>Port 3000 already in use</td>
                <td><code>sudo lsof -i:3000</code> → <code>kill &lt;PID&gt;</code></td>
            </tr>
            <tr>
                <td>Empty dropdowns in New Batch modal</td>
                <td>Ensure <code>database/nacha-vendor-payments-schema.sql</code> was run & server restarted</td>
            </tr>
            <tr>
                <td>CSS not updating</td>
                <td>Hard-refresh (Ctrl+F5) or clear browser cache</td>
            </tr>
        </tbody>
    </table>
    
    <h1>9. Performance Tips</h1>
    
    <ol>
        <li>Allocate extra vCPU/RAM in VM settings.</li>
        <li>Enable <strong>Nested Paging</strong> & <strong>KVM Paravirtualization</strong>.</li>
        <li>Store VDI on SSD/NVMe.</li>
        <li>Tune PostgreSQL (<code>shared_buffers = 512MB</code>, <code>work_mem = 16MB</code>).</li>
        <li>Use <strong>Bridged Adapter</strong> for faster host↔guest transfers.</li>
    </ol>
    
    <div class="page-break"></div>
    
    <h1>10. Security Notes</h1>
    
    <ul>
        <li>Change default passwords (<code>npfa123</code>) before production.</li>
        <li>Keep <code>.env</code> file <strong>chmod 600</strong>.</li>
        <li>
            Enable UFW:
            <pre>
sudo ufw allow 8080/tcp
sudo ufw allow 3000/tcp
sudo ufw enable</pre>
        </li>
        <li>Snapshot VM after successful install for quick rollback.</li>
    </ul>
    
    <div class="section-divider"></div>
    
    <h1>Appendix A – Useful Commands</h1>
    
    <pre>
# Stop servers
pkill -f http-server
pkill -f node

# Backup database
sudo -u postgres pg_dump -Fc fund_accounting_db > fundacct_$(date +%F).dump

# Restore
sudo -u postgres pg_restore -d fund_accounting_db -c fundacct_2025-07-19.dump
</pre>
    
    <div class="conclusion">
        <p><strong>Enjoy your fully-functional Non-Profit Fund Accounting System v9.0 on Ubuntu 24.04!</strong><br>
        For more details see the in-app <strong>Documentation</strong> tab or the project README.</p>
    </div>
    
    <div class="footer">
        Non-Profit Fund Accounting System v9.0 | VirtualBox Ubuntu 24.04 Installation Guide
    </div>
    
    <script>
        // Add page numbers to TOC based on actual layout
        window.addEventListener('load', function() {
            if (window.matchMedia('screen').matches) {
                document.querySelector('.print-button').style.display = 'block';
            }
        });
    </script>
</body>
</html>
