<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NACHA Vendor Payments - Nonprofit Fund Accounting</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="src/css/vendor-payments.css" rel="stylesheet">
</head>
<body>
    <div class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <div class="container-fluid mt-4">
        <!-- Single centered Back button -->
        <div class="text-center mb-4">
            <button
                class="action-button"
                onclick="window.location.href='index.html'">
                <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
            </button>
        </div>
        
        <div class="row">
            <div class="col-12">
                <h1>NACHA Vendor Payments</h1>
                <p class="lead">Manage vendors, payment batches, and generate NACHA files for ACH transfers.</p>
            </div>
        </div>

        <ul class="nav nav-tabs" id="paymentTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="batches-tab" data-bs-toggle="tab" data-bs-target="#batches" type="button" role="tab">Payment Batches</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="vendors-tab" data-bs-toggle="tab" data-bs-target="#vendors" type="button" role="tab">Vendors</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">NACHA Settings</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="files-tab" data-bs-toggle="tab" data-bs-target="#files" type="button" role="tab">NACHA Files</button>
            </li>
        </ul>

        <div class="tab-content" id="paymentTabsContent">
            <!-- PAYMENT BATCHES TAB -->
            <div class="tab-pane fade show active" id="batches" role="tabpanel">
                <div class="section-header d-flex justify-content-between align-items-center">
                    <h2>Payment Batches</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createBatchModal">
                        <i class="fas fa-plus"></i> New Batch
                    </button>
                </div>

                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="input-group">
                            <input type="text" class="form-control" id="batchSearchInput" placeholder="Search batches...">
                            <button class="btn btn-outline-secondary" type="button" id="batchSearchBtn">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex justify-content-end">
                            <select class="form-select me-2" id="batchStatusFilter" style="width: auto;">
                                <option value="">All Statuses</option>
                                <option value="draft">Draft</option>
                                <option value="pending_approval">Pending Approval</option>
                                <option value="approved">Approved</option>
                                <option value="processed">Processed</option>
                            </select>
                            <button class="btn btn-outline-secondary" id="refreshBatchesBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="batchesTable">
                        <thead>
                            <tr>
                                <th>Batch Number</th>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Entity</th>
                                <th>Total Amount</th>
                                <th>Items</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="batchesTableBody">
                            <!-- Batch rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- VENDORS TAB -->
            <div class="tab-pane fade" id="vendors" role="tabpanel">
                <div class="section-header d-flex justify-content-between align-items-center">
                    <h2>Vendors</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createVendorModal">
                        <i class="fas fa-plus"></i> New Vendor
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="vendorsTable">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Name</th>
                                <th>Contact</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Bank Accounts</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="vendorsTableBody">
                            <!-- Vendor rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- NACHA SETTINGS TAB -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
                <div class="section-header d-flex justify-content-between align-items-center">
                    <h2>NACHA Settings</h2>
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createNachaSettingsModal">
                        <i class="fas fa-plus"></i> New NACHA Configuration
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="nachaSettingsTable">
                        <thead>
                            <tr>
                                <th>Company Name</th>
                                <th>Company ID</th>
                                <th>Originating DFI ID</th>
                                <th>Entry Description</th>
                                <th>Settlement Account</th>
                                <th>Production Mode</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="nachaSettingsTableBody">
                            <!-- NACHA settings rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- NACHA FILES TAB -->
            <div class="tab-pane fade" id="files" role="tabpanel">
                <div class="section-header d-flex justify-content-between align-items-center">
                    <h2>NACHA Files</h2>
                    <button class="btn btn-outline-secondary" id="refreshFilesBtn">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="nachaFilesTable">
                        <thead>
                            <tr>
                                <th>File Name</th>
                                <th>Batch Number</th>
                                <th>File Date</th>
                                <th>Total Amount</th>
                                <th>Items</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="nachaFilesTableBody">
                            <!-- NACHA files rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Batch Modal -->
    <div class="modal fade" id="createBatchModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Create Payment Batch</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createBatchForm">
                        <div class="mb-3">
                            <label for="batchEntityId" class="form-label">Entity*</label>
                            <select class="form-select" id="batchEntityId" required>
                                <option value="">-- Select Entity --</option>
                                <!-- Entities will be populated dynamically -->
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="batchFundId" class="form-label">Fund</label>
                            <select class="form-select" id="batchFundId">
                                <option value="">-- Select Fund --</option>
                                <!-- Funds will be populated dynamically -->
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="nachaSettingsId" class="form-label">NACHA Settings*</label>
                            <select class="form-select" id="nachaSettingsId" required>
                                <option value="">-- Select NACHA Configuration --</option>
                                <!-- NACHA settings will be populated dynamically -->
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="batchDate" class="form-label">Batch Date*</label>
                            <input type="date" class="form-control" id="batchDate" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="effectiveDate" class="form-label">Effective Date*</label>
                            <input type="date" class="form-control" id="effectiveDate" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="batchDescription" class="form-label">Description*</label>
                            <input type="text" class="form-control" id="batchDescription" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveBatchBtn">Create Batch</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Success/Error Toast -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                Operation completed successfully.
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="src/js/vendor-payments.js"></script>
</body>
</html>
