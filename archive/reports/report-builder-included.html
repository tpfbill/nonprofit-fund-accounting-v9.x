<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Non-Profit Fund Accounting</title>
    <style>
        /* Basic reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        /* Header - using static positioning */
        .header {
            background-color: #1976d2;
            color: white;
            padding: 15px 20px;
            border-bottom: 3px solid #0d47a1;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 24px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info span {
            font-weight: 500;
        }

        .logout-button {
            background-color: #0d47a1;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Main navigation menu - horizontal under the header */
        .main-nav {
            background-color: #f0f0f0;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .nav-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .nav-item {
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .nav-item:hover {
            background-color: #e0e0e0;
        }

        .nav-item.active {
            background-color: #2196f3;
            color: white;
        }

        /* Layout */
        .container {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            gap: 20px;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 10px;
        }

        .sidebar-menu a {
            display: block;
            padding: 10px;
            color: #333;
            text-decoration: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .sidebar-menu a:hover {
            background-color: #f0f0f0;
        }

        .sidebar-menu a.active {
            background-color: #e3f2fd;
            color: #1976d2;
            border-left: 3px solid #1976d2;
        }

        /* Main content */
        .main-content {
            flex: 1;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .action-button {
            background-color: #4caf50; /* Green for main actions */
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .action-button:hover {
            background-color: #43a047;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .data-table th, 
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .data-table th {
            background-color: #f9f9f9;
            font-weight: 600;
        }

        .data-table tbody tr:hover {
            background-color: #f5f5f5;
        }

        /* Tabs */
        .tab-container {
            margin-bottom: 20px;
        }

        .tab-menu {
            display: flex;
            border-bottom: 1px solid #ddd;
        }

        .tab-item {
            padding: 10px 20px;
            cursor: pointer;
            border: 1px solid transparent;
        }

        .tab-item.active {
            border: 1px solid #ddd;
            border-bottom-color: white;
            border-radius: 4px 4px 0 0;
            margin-bottom: -1px;
            font-weight: 500;
        }

        .tab-content {
            padding: 20px 0;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            border-top: 3px solid #1976d2;
        }

        .card-title {
            font-size: 18px;
            margin-bottom: 10px;
        }

        .card-value {
            font-size: 24px;
            font-weight: 600;
            color: #1976d2;
        }

        /* Dashboard panels */
        .dashboard-panel {
            display: none;
        }

        .dashboard-panel.active {
            display: block;
        }

        /* Form elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #1976d2;
            box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.2);
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 10px;
        }

        .form-column {
            flex: 1;
            min-width: 200px;
        }

        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .form-actions {
            margin-top: 30px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .btn-secondary {
            background-color: #757575;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-secondary:hover {
            background-color: #616161;
        }

        /* Report styling */
        .reports-gallery {
            display: block;
        }

        .report-view {
            display: none;
        }

        .report-container {
            background-color: white;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .report-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .report-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .report-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 5px;
        }

        .report-date {
            font-size: 14px;
            color: #666;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .report-table th,
        .report-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .report-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }

        .report-table .amount-col {
            text-align: right;
        }

        .report-table .total-row {
            font-weight: 600;
            border-top: 2px solid #333;
        }

        .report-table .subtotal-row {
            font-weight: 600;
            border-top: 1px solid #666;
        }

        .report-table .section-header {
            background-color: #f9f9f9;
            font-weight: 600;
        }

        .report-footer {
            margin-top: 30px;
            font-size: 12px;
            color: #666;
            text-align: center;
        }

        .report-actions {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }

        .report-filters {
            display: flex;
            gap: 15px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .report-tools {
            display: flex;
            gap: 10px;
        }
        
        /* Modal Dialog CSS */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none; /* Initially hidden */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-dialog {
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 600px; /* Adjust as needed */
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px; /* Made it a bit larger */
            cursor: pointer;
            color: #666;
            padding: 0;
            line-height: 1;
        }

        .modal-body {
            padding: 20px;
            flex-grow: 1; /* Allows body to expand if content is large */
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Status indicators */
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active {
            background-color: #e8f5e9;
            color: #2e7d32;
        }

        .status-inactive {
            background-color: #f5f5f5;
            color: #757575;
        }

        .status-pending {
            background-color: #fff8e1;
            color: #ff8f00;
        }

        /* Utils */
        .mt-20 {
            margin-top: 20px;
        }
        
        .text-right {
            text-align: right;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .badge-blue {
            background-color: #e3f2fd;
            color: #1976d2;
        }
        
        .badge-green {
            background-color: #e8f5e9;
            color: #2e7d32;
        }
        
        .badge-amber {
            background-color: #fff8e1;
            color: #ff8f00;
        }
        
        .badge-red {
            background-color: #ffebee;
            color: #c62828;
        }

        /* Page */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Add these styles in the CSS section */
        .drillable {
            cursor: pointer;
            color: #1565c0;
            text-decoration: underline;
        }

        .drillable:hover {
            color: #0d47a1;
            text-decoration: underline;
        }

        /* Drill-down modal styles */
        .drill-down-modal .modal-dialog {
            max-width: 800px;
        }

        .drill-down-modal .modal-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .drill-down-modal .modal-title .amount {
            font-weight: normal;
            color: #1976d2;
        }

        .drill-down-path {
            margin: -10px 0 15px 0;
            padding: 0 0 10px 0;
            border-bottom: 1px solid #eee;
            color: #757575;
            font-size: 14px;
        }

        /* --------------------------------------------------------------
           Report Builder Styles
        -------------------------------------------------------------- */
        .field-selector {
            border: 1px solid #ddd;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: #f9f9f9;
        }

        .field-item {
            padding: 8px 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .field-item:hover {
            background-color: #f0f0f0;
        }

        .field-item.selected {
            background-color: #e3f2fd;
            border-left: 3px solid #1976d2;
        }

        .selected-fields-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 100px;
            padding: 10px;
            margin-top: 10px;
        }

        .selected-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: #e3f2fd;
            border-radius: 4px;
            margin-bottom: 5px;
        }

        .selected-field button {
            background: none;
            border: none;
            color: #757575;
            cursor: pointer;
        }

        .selected-field button:hover {
            color: #d32f2f;
        }

        .filter-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .report-preview {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-top: 20px;
        }

        .preview-placeholder {
            text-align: center;
            padding: 20px;
            color: #757575;
            font-style: italic;
        }

        /* Custom report card in gallery */
        .custom-report-card {
            background-color: #f5f5f5;
            border-left: 5px solid #4caf50;
        }

        .report-toolbar {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

    </style>
</head>
<body>
    <!-- Header - Static positioning (not fixed) -->
    <div class="header">
        <div class="header-container">
            <h1>Non-Profit Fund Accounting System</h1>
            <div class="user-info">
                <span>John Doe</span>
                <button class="logout-button">Logout</button>
            </div>
        </div>
    </div>

    <!-- Main Navigation -->
    <div class="main-nav">
        <div class="nav-container">
            <div class="nav-item active" data-page="dashboard">Dashboard</div>
            <div class="nav-item" data-page="chart-of-accounts">Chart of Accounts</div>
            <div class="nav-item" data-page="funds">Funds</div>
            <div class="nav-item" data-page="journal-entries">Journal Entries</div>
            <div class="nav-item" data-page="reports">Reports</div>
            <div class="nav-item" data-page="settings">Settings</div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Quick-actions shown only on dashboard -->
            <div id="quick-actions-container">
                <h3>Quick Actions</h3>
                <ul class="sidebar-menu mt-20">
                    <li><a href="#" class="sidebar-item active" data-panel="financial-overview-panel">Financial Overview</a></li>
                    <li><a href="#" class="sidebar-item" data-panel="recent-transactions-panel">Recent Transactions</a></li>
                    <li><a href="#" class="sidebar-item" data-panel="unposted-entries-panel">Unposted Entries</a></li>
                    <li><a href="#" class="sidebar-item" data-panel="budget-analysis-panel">Budget Analysis</a></li>
                    <li><a href="#" class="sidebar-item" data-panel="fund-balances-panel">Fund Balances</a></li>
                </ul>
            </div>
            <!-- Placeholder content shown on non-dashboard pages -->
            <div id="page-actions-container" style="display:none;">
                <h3>Page Actions</h3>
                <p class="mt-20">Select an item from the main menu to view available actions.</p>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Dashboard -->
            <div id="dashboard-page" class="page active">
                <div class="content-header">
                    <h2>Dashboard</h2>
                    <button class="action-button">Print Report</button>
                </div>

                <!-- Financial Overview Panel (default active) -->
                <div id="financial-overview-panel" class="dashboard-panel active">
                    <!-- Summary Cards -->
                    <div class="card-grid">
                        <div class="card">
                            <div class="card-title">Total Assets</div>
                            <div class="card-value">$1,254,897.00</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Total Liabilities</div>
                            <div class="card-value">$341,250.00</div>
                        </div>
                        <div class="card">
                            <div class="card-title">Net Assets</div>
                            <div class="card-value">$913,647.00</div>
                        </div>
                        <div class="card">
                            <div class="card-title">YTD Revenue</div>
                            <div class="card-value">$567,890.00</div>
                        </div>
                    </div>

                    <!-- Fund Balances -->
                    <h3 class="mt-20">Fund Balances</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fund Name</th>
                                <th>Type</th>
                                <th>Balance</th>
                                <th>% of Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>General Operating</td>
                                <td>Unrestricted</td>
                                <td>$425,781.00</td>
                                <td>46.6%</td>
                            </tr>
                            <tr>
                                <td>Building Fund</td>
                                <td>Temporarily Restricted</td>
                                <td>$128,450.00</td>
                                <td>14.1%</td>
                            </tr>
                            <tr>
                                <td>Endowment</td>
                                <td>Permanently Restricted</td>
                                <td>$250,000.00</td>
                                <td>27.4%</td>
                            </tr>
                            <tr>
                                <td>Program Services</td>
                                <td>Temporarily Restricted</td>
                                <td>$109,416.00</td>
                                <td>11.9%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Recent Transactions Panel -->
                <div id="recent-transactions-panel" class="dashboard-panel">
                    <h3>Recent Transactions</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Reference</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2025-06-15</td>
                                <td>JE-2025-0145</td>
                                <td>Grant Payment - Johnson Foundation</td>
                                <td>$25,000.00</td>
                                <td>Posted</td>
                            </tr>
                            <tr>
                                <td>2025-06-14</td>
                                <td>JE-2025-0144</td>
                                <td>Monthly Rent Payment</td>
                                <td>$4,500.00</td>
                                <td>Posted</td>
                            </tr>
                            <tr>
                                <td>2025-06-12</td>
                                <td>JE-2025-0143</td>
                                <td>Utility Bills - June</td>
                                <td>$1,250.00</td>
                                <td>Posted</td>
                            </tr>
                            <tr>
                                <td>2025-06-10</td>
                                <td>JE-2025-0142</td>
                                <td>Staff Payroll - First Half June</td>
                                <td>$28,750.00</td>
                                <td>Posted</td>
                            </tr>
                            <tr>
                                <td>2025-06-08</td>
                                <td>JE-2025-0141</td>
                                <td>Individual Donation - Smith Family</td>
                                <td>$5,000.00</td>
                                <td>Posted</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Unposted Entries Panel -->
                <div id="unposted-entries-panel" class="dashboard-panel">
                    <h3>Unposted Journal Entries</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Reference</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Created By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>2025-06-17</td>
                                <td>JE-2025-0146</td>
                                <td>Community Event Donations</td>
                                <td>$3,450.00</td>
                                <td>Mary Johnson</td>
                                <td>
                                    <button class="action-button">Post</button>
                                </td>
                            </tr>
                            <tr>
                                <td>2025-06-17</td>
                                <td>JE-2025-0147</td>
                                <td>Office Supplies Purchase</td>
                                <td>$875.25</td>
                                <td>Robert Smith</td>
                                <td>
                                    <button class="action-button">Post</button>
                                </td>
                            </tr>
                            <tr>
                                <td>2025-06-16</td>
                                <td>JE-2025-0148</td>
                                <td>Program Expenses - Youth Workshop</td>
                                <td>$2,340.00</td>
                                <td>Jane Wilson</td>
                                <td>
                                    <button class="action-button">Post</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Budget Analysis Panel -->
                <div id="budget-analysis-panel" class="dashboard-panel">
                    <h3>Budget vs. Actual (Current Fiscal Year)</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Budget</th>
                                <th>Actual</th>
                                <th>Variance</th>
                                <th>% Used</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Program Services</td>
                                <td>$425,000.00</td>
                                <td>$256,789.00</td>
                                <td>$168,211.00</td>
                                <td>60.4%</td>
                            </tr>
                            <tr>
                                <td>Administrative</td>
                                <td>$175,000.00</td>
                                <td>$112,450.00</td>
                                <td>$62,550.00</td>
                                <td>64.3%</td>
                            </tr>
                            <tr>
                                <td>Fundraising</td>
                                <td>$95,000.00</td>
                                <td>$87,125.00</td>
                                <td>$7,875.00</td>
                                <td>91.7%</td>
                            </tr>
                            <tr>
                                <td>Capital Expenses</td>
                                <td>$50,000.00</td>
                                <td>$12,450.00</td>
                                <td>$37,550.00</td>
                                <td>24.9%</td>
                            </tr>
                            <tr>
                                <td><strong>Total Expenses</strong></td>
                                <td><strong>$745,000.00</strong></td>
                                <td><strong>$468,814.00</strong></td>
                                <td><strong>$276,186.00</strong></td>
                                <td><strong>62.9%</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Fund Balances Panel -->
                <div id="fund-balances-panel" class="dashboard-panel">
                    <h3>Fund Balances - Detailed</h3>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Fund ID</th>
                                <th>Fund Name</th>
                                <th>Type</th>
                                <th>Beginning Balance</th>
                                <th>Revenue</th>
                                <th>Expenses</th>
                                <th>Current Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>F001</td>
                                <td>General Operating</td>
                                <td>Unrestricted</td>
                                <td>$375,250.00</td>
                                <td>$250,531.00</td>
                                <td>$200,000.00</td>
                                <td>$425,781.00</td>
                            </tr>
                            <tr>
                                <td>F002</td>
                                <td>Building Fund</td>
                                <td>Temporarily Restricted</td>
                                <td>$100,000.00</td>
                                <td>$50,000.00</td>
                                <td>$21,550.00</td>
                                <td>$128,450.00</td>
                            </tr>
                            <tr>
                                <td>F003</td>
                                <td>Endowment</td>
                                <td>Permanently Restricted</td>
                                <td>$250,000.00</td>
                                <td>$0.00</td>
                                <td>$0.00</td>
                                <td>$250,000.00</td>
                            </tr>
                            <tr>
                                <td>F004</td>
                                <td>Program Services</td>
                                <td>Temporarily Restricted</td>
                                <td>$85,000.00</td>
                                <td>$125,000.00</td>
                                <td>$100,584.00</td>
                                <td>$109,416.00</td>
                            </tr>
                            <tr>
                                <td colspan="3" class="text-right"><strong>Totals:</strong></td>
                                <td><strong>$810,250.00</strong></td>
                                <td><strong>$425,531.00</strong></td>
                                <td><strong>$322,134.00</strong></td>
                                <td><strong>$913,647.00</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Chart of Accounts Page (hidden by default) -->
            <div id="chart-of-accounts-page" class="page" style="display:none;">
                <div class="content-header">
                    <h2>Chart of Accounts</h2>
                    <button class="action-button" id="btn-add-account">Add Account</button>
                </div>

                <!-- Tabs -->
                <div class="tab-container">
                    <div class="tab-menu">
                        <div class="tab-item active" data-tab="accounts-list">List View</div>
                        <div class="tab-item" data-tab="accounts-tree">Tree View</div>
                    </div>
                    <div class="tab-content">
                        <div id="accounts-list" class="tab-panel active">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Code</th>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>Balance</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>1000</td>
                                        <td>Cash and Cash Equivalents</td>
                                        <td>Asset</td>
                                        <td>$145,250.00</td>
                                        <td><span class="status status-active">Active</span></td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>1010</td>
                                        <td>Operating Checking</td>
                                        <td>Asset</td>
                                        <td>$45,250.00</td>
                                        <td><span class="status status-active">Active</span></td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>1020</td>
                                        <td>Savings Account</td>
                                        <td>Asset</td>
                                        <td>$100,000.00</td>
                                        <td><span class="status status-active">Active</span></td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>1100</td>
                                        <td>Accounts Receivable</td>
                                        <td>Asset</td>
                                        <td>$12,450.00</td>
                                        <td><span class="status status-active">Active</span></td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>2000</td>
                                        <td>Accounts Payable</td>
                                        <td>Liability</td>
                                        <td>$8,720.00</td>
                                        <td><span class="status status-active">Active</span></td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>3000</td>
                                        <td>Net Assets</td>
                                        <td>Equity</td>
                                        <td>$48,980.00</td>
                                        <td><span class="status status-active">Active</span></td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>4000</td>
                                        <td>Grant Revenue</td>
                                        <td>Revenue</td>
                                        <td>$275,000.00</td>
                                        <td><span class="status status-active">Active</span></td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>4100</td>
                                        <td>Individual Contributions</td>
                                        <td>Revenue</td>
                                        <td>$125,250.00</td>
                                        <td><span class="status status-active">Active</span></td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="accounts-tree" class="tab-panel">
                            <p>Tree view of accounts would be displayed here with proper hierarchy.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Funds Management Page (hidden by default) -->
            <div id="funds-page" class="page" style="display:none;">
                <div class="content-header">
                    <h2>Funds Management</h2>
                    <button class="action-button" id="btn-add-fund">Add Fund</button>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Fund Code</th>
                            <th>Fund Name</th>
                            <th>Type</th>
                            <th>Balance</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>GEN</td>
                            <td>General Operating Fund</td>
                            <td>Unrestricted</td>
                            <td>$425,781.00</td>
                            <td>Active</td>
                            <td><button class="action-button">Edit</button></td>
                        </tr>
                        <tr>
                            <td>BLDG</td>
                            <td>Building Fund</td>
                            <td>Temporarily Restricted</td>
                            <td>$128,450.00</td>
                            <td>Active</td>
                            <td><button class="action-button">Edit</button></td>
                        </tr>
                        <tr>
                            <td>ENDOW</td>
                            <td>Endowment Fund</td>
                            <td>Permanently Restricted</td>
                            <td>$250,000.00</td>
                            <td>Active</td>
                            <td><button class="action-button">Edit</button></td>
                        </tr>
                        <tr>
                            <td>PROG</td>
                            <td>Program Services Fund</td>
                            <td>Temporarily Restricted</td>
                            <td>$109,416.00</td>
                            <td>Active</td>
                            <td><button class="action-button">Edit</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Journal Entries Page (hidden by default) -->
            <div id="journal-entries-page" class="page" style="display:none;">
                <div class="content-header">
                    <h2>Journal Entries</h2>
                    <button class="action-button" id="btn-new-journal-entry">New Journal Entry</button>
                </div>
                
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Reference</th>
                            <th>Description</th>
                            <th>Total Amount</th>
                            <th>Status</th>
                            <th>Created By</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2025-06-17</td>
                            <td>JE-2025-0146</td>
                            <td>Community Event Donations</td>
                            <td>$3,450.00</td>
                            <td>Unposted</td>
                            <td>Mary Johnson</td>
                            <td><button class="action-button">View</button></td>
                        </tr>
                        <tr>
                            <td>2025-06-15</td>
                            <td>JE-2025-0145</td>
                            <td>Grant Payment â€“ Johnson Foundation</td>
                            <td>$25,000.00</td>
                            <td>Posted</td>
                            <td>John Doe</td>
                            <td><button class="action-button">View</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Reports Page (hidden by default) -->
            <div id="reports-page" class="page" style="display:none;">
                <div class="content-header">
                    <h2>Financial Reports</h2>
                </div>
                
                <!-- Reports Gallery (default view) -->
                <div id="reports-gallery" class="reports-gallery">
                    <div class="card-grid">
                        <div class="card">
                            <div class="card-title">Statement of Financial Position</div>
                            <p>Balance sheet showing assets, liabilities, and net assets.</p>
                            <button class="action-button mt-20" data-report="financial-position">Generate</button>
                        </div>
                        <div class="card">
                            <div class="card-title">Statement of Activities</div>
                            <p>Income statement showing revenue, expenses, and changes in net assets.</p>
                            <button class="action-button mt-20" data-report="activities">Generate</button>
                        </div>
                        <div class="card">
                            <div class="card-title">Statement of Functional Expenses</div>
                            <p>Expenses categorized by program, administrative, and fundraising.</p>
                            <button class="action-button mt-20" data-report="functional-expenses">Generate</button>
                        </div>
                        <div class="card">
                            <div class="card-title">Budget vs. Actual</div>
                            <p>Comparison of budgeted and actual amounts with variances.</p>
                            <button class="action-button mt-20" data-report="budget-vs-actual">Generate</button>
                        </div>
                        <!-- New card for custom report builder -->
                        <div class="card">
                            <div class="card-title">Custom Report Builder</div>
                            <p>Build your own custom reports by selecting fields, filters, and output formats.</p>
                            <button class="action-button mt-20" id="create-custom-report">Create New Report</button>
                        </div>
                    </div>

                    <!-- Custom Reports Section -->
                    <h3 class="mt-20">Custom Reports</h3>
                    <div id="custom-reports-container" class="card-grid" style="display: none;">
                        <!-- Custom reports will be added here dynamically -->
                        <div class="preview-placeholder">
                            No custom reports have been created yet. Use the Create New Report button above to build your own reports.
                        </div>
                    </div>
                </div>
                
                <!-- Statement of Financial Position (Balance Sheet) Report -->
                <div id="financial-position-report" class="report-view">
                    <div class="report-actions">
                        <button class="btn-secondary" data-action="back-to-gallery">Back to Reports</button>
                        <div class="report-tools">
                            <button class="action-button">Print</button>
                            <button class="action-button">Export PDF</button>
                            <button class="action-button">Export Excel</button>
                        </div>
                    </div>
                    
                    <div class="report-container">
                        <div class="report-header">
                            <div class="report-title">Community Nonprofit Foundation</div>
                            <div class="report-subtitle">Statement of Financial Position</div>
                            <div class="report-date">As of June 17, 2025</div>
                        </div>
                        
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>Assets</th>
                                    <th class="amount-col">Amount</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Current Assets Section -->
                                <tr class="section-header">
                                    <td colspan="2">Current Assets</td>
                                </tr>
                                <tr>
                                    <td>Cash and Cash Equivalents</td>
                                    <td class="amount-col">$238,450.00</td>
                                </tr>
                                <tr>
                                    <td>Accounts Receivable</td>
                                    <td class="amount-col">$45,250.00</td>
                                </tr>
                                <tr>
                                    <td>Grants Receivable</td>
                                    <td class="amount-col">$125,000.00</td>
                                </tr>
                                <tr>
                                    <td>Prepaid Expenses</td>
                                    <td class="amount-col">$12,450.00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Current Assets</td>
                                    <td class="amount-col">$421,150.00</td>
                                </tr>
                                
                                <!-- Fixed Assets Section -->
                                <tr class="section-header">
                                    <td colspan="2">Fixed Assets</td>
                                </tr>
                                <tr>
                                    <td>Land</td>
                                    <td class="amount-col">$250,000.00</td>
                                </tr>
                                <tr>
                                    <td>Buildings and Improvements</td>
                                    <td class="amount-col">$750,000.00</td>
                                </tr>
                                <tr>
                                    <td>Furniture and Equipment</td>
                                    <td class="amount-col">$85,450.00</td>
                                </tr>
                                <tr>
                                    <td>Less: Accumulated Depreciation</td>
                                    <td class="amount-col">($251,703.00)</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Fixed Assets</td>
                                    <td class="amount-col">$833,747.00</td>
                                </tr>
                                
                                <!-- Total Assets -->
                                <tr class="total-row">
                                    <td>Total Assets</td>
                                    <td class="amount-col">$1,254,897.00</td>
                                </tr>
                                
                                <!-- Liabilities Section -->
                                <tr class="section-header">
                                    <td colspan="2">Liabilities</td>
                                </tr>
                                <tr>
                                    <td>Accounts Payable</td>
                                    <td class="amount-col">$34,250.00</td>
                                </tr>
                                <tr>
                                    <td>Accrued Expenses</td>
                                    <td class="amount-col">$27,000.00</td>
                                </tr>
                                <tr>
                                    <td>Deferred Revenue</td>
                                    <td class="amount-col">$80,000.00</td>
                                </tr>
                                <tr>
                                    <td>Notes Payable (current portion)</td>
                                    <td class="amount-col">$50,000.00</td>
                                </tr>
                                <tr>
                                    <td>Mortgage Payable (long-term)</td>
                                    <td class="amount-col">$150,000.00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Liabilities</td>
                                    <td class="amount-col">$341,250.00</td>
                                </tr>
                                
                                <!-- Net Assets Section -->
                                <tr class="section-header">
                                    <td colspan="2">Net Assets</td>
                                </tr>
                                <tr>
                                    <td>Without Donor Restrictions</td>
                                    <td class="amount-col">$535,197.00</td>
                                </tr>
                                <tr>
                                    <td>With Donor Restrictions</td>
                                    <td class="amount-col">$378,450.00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Net Assets</td>
                                    <td class="amount-col">$913,647.00</td>
                                </tr>
                                
                                <!-- Total Liabilities and Net Assets -->
                                <tr class="total-row">
                                    <td>Total Liabilities and Net Assets</td>
                                    <td class="amount-col">$1,254,897.00</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="report-footer">
                            Unaudited - For Management Purposes Only
                        </div>
                    </div>
                </div>
                
                <!-- Statement of Activities (Income Statement) Report -->
                <div id="activities-report" class="report-view">
                    <div class="report-actions">
                        <button class="btn-secondary" data-action="back-to-gallery">Back to Reports</button>
                        <div class="report-tools">
                            <button class="action-button">Print</button>
                            <button class="action-button">Export PDF</button>
                            <button class="action-button">Export Excel</button>
                        </div>
                    </div>
                    
                    <div class="report-container">
                        <div class="report-header">
                            <div class="report-title">Community Nonprofit Foundation</div>
                            <div class="report-subtitle">Statement of Activities</div>
                            <div class="report-date">For the Year Ended June 30, 2025</div>
                        </div>
                        
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th></th>
                                    <th class="amount-col">Without Donor Restrictions</th>
                                    <th class="amount-col">With Donor Restrictions</th>
                                    <th class="amount-col">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Revenue and Support Section -->
                                <tr class="section-header">
                                    <td colspan="4">Revenue and Support</td>
                                </tr>
                                <tr>
                                    <td>Contributions and Grants</td>
                                    <td class="amount-col">$245,000.00</td>
                                    <td class="amount-col">$175,000.00</td>
                                    <td class="amount-col">$420,000.00</td>
                                </tr>
                                <tr>
                                    <td>Program Service Fees</td>
                                    <td class="amount-col">$85,450.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$85,450.00</td>
                                </tr>
                                <tr>
                                    <td>Investment Income</td>
                                    <td class="amount-col">$12,440.00</td>
                                    <td class="amount-col">$8,000.00</td>
                                    <td class="amount-col">$20,440.00</td>
                                </tr>
                                <tr>
                                    <td>Special Events (net)</td>
                                    <td class="amount-col">$42,000.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$42,000.00</td>
                                </tr>
                                <tr>
                                    <td>Net Assets Released from Restrictions</td>
                                    <td class="amount-col">$125,000.00</td>
                                    <td class="amount-col">($125,000.00)</td>
                                    <td class="amount-col">$0.00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Revenue and Support</td>
                                    <td class="amount-col">$509,890.00</td>
                                    <td class="amount-col">$58,000.00</td>
                                    <td class="amount-col">$567,890.00</td>
                                </tr>
                                
                                <!-- Expenses Section -->
                                <tr class="section-header">
                                    <td colspan="4">Expenses</td>
                                </tr>
                                <tr>
                                    <td>Program Services</td>
                                    <td class="amount-col">$285,450.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$285,450.00</td>
                                </tr>
                                <tr>
                                    <td>Management and General</td>
                                    <td class="amount-col">$98,750.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$98,750.00</td>
                                </tr>
                                <tr>
                                    <td>Fundraising</td>
                                    <td class="amount-col">$67,240.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$67,240.00</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Expenses</td>
                                    <td class="amount-col">$451,440.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$451,440.00</td>
                                </tr>
                                
                                <!-- Change in Net Assets -->
                                <tr class="total-row">
                                    <td>Change in Net Assets</td>
                                    <td class="amount-col">$58,450.00</td>
                                    <td class="amount-col">$58,000.00</td>
                                    <td class="amount-col">$116,450.00</td>
                                </tr>
                                
                                <!-- Net Assets Beginning -->
                                <tr>
                                    <td>Net Assets, Beginning of Year</td>
                                    <td class="amount-col">$476,747.00</td>
                                    <td class="amount-col">$320,450.00</td>
                                    <td class="amount-col">$797,197.00</td>
                                </tr>
                                
                                <!-- Net Assets Ending -->
                                <tr class="total-row">
                                    <td>Net Assets, End of Year</td>
                                    <td class="amount-col">$535,197.00</td>
                                    <td class="amount-col">$378,450.00</td>
                                    <td class="amount-col">$913,647.00</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="report-footer">
                            Unaudited - For Management Purposes Only
                        </div>
                    </div>
                </div>
                
                <!-- Statement of Functional Expenses Report -->
                <div id="functional-expenses-report" class="report-view">
                    <div class="report-actions">
                        <button class="btn-secondary" data-action="back-to-gallery">Back to Reports</button>
                        <div class="report-tools">
                            <button class="action-button">Print</button>
                            <button class="action-button">Export PDF</button>
                            <button class="action-button">Export Excel</button>
                        </div>
                    </div>
                    
                    <div class="report-container">
                        <div class="report-header">
                            <div class="report-title">Community Nonprofit Foundation</div>
                            <div class="report-subtitle">Statement of Functional Expenses</div>
                            <div class="report-date">For the Year Ended June 30, 2025</div>
                        </div>
                        
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>Expense Category</th>
                                    <th class="amount-col">Program Services</th>
                                    <th class="amount-col">Management & General</th>
                                    <th class="amount-col">Fundraising</th>
                                    <th class="amount-col">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Salaries and Wages</td>
                                    <td class="amount-col">$145,250.00</td>
                                    <td class="amount-col">$42,450.00</td>
                                    <td class="amount-col">$35,300.00</td>
                                    <td class="amount-col">$223,000.00</td>
                                </tr>
                                <tr>
                                    <td>Employee Benefits</td>
                                    <td class="amount-col">$25,450.00</td>
                                    <td class="amount-col">$7,450.00</td>
                                    <td class="amount-col">$6,200.00</td>
                                    <td class="amount-col">$39,100.00</td>
                                </tr>
                                <tr>
                                    <td>Payroll Taxes</td>
                                    <td class="amount-col">$12,250.00</td>
                                    <td class="amount-col">$3,575.00</td>
                                    <td class="amount-col">$2,975.00</td>
                                    <td class="amount-col">$18,800.00</td>
                                </tr>
                                <tr>
                                    <td>Professional Services</td>
                                    <td class="amount-col">$18,450.00</td>
                                    <td class="amount-col">$24,125.00</td>
                                    <td class="amount-col">$5,250.00</td>
                                    <td class="amount-col">$47,825.00</td>
                                </tr>
                                <tr>
                                    <td>Occupancy</td>
                                    <td class="amount-col">$25,000.00</td>
                                    <td class="amount-col">$5,000.00</td>
                                    <td class="amount-col">$3,000.00</td>
                                    <td class="amount-col">$33,000.00</td>
                                </tr>
                                <tr>
                                    <td>Supplies</td>
                                    <td class="amount-col">$35,250.00</td>
                                    <td class="amount-col">$4,250.00</td>
                                    <td class="amount-col">$2,150.00</td>
                                    <td class="amount-col">$41,650.00</td>
                                </tr>
                                <tr>
                                    <td>Travel</td>
                                    <td class="amount-col">$8,750.00</td>
                                    <td class="amount-col">$1,250.00</td>
                                    <td class="amount-col">$3,450.00</td>
                                    <td class="amount-col">$13,450.00</td>
                                </tr>
                                <tr>
                                    <td>Direct Assistance</td>
                                    <td class="amount-col">$10,500.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$10,500.00</td>
                                </tr>
                                <tr>
                                    <td>Printing and Postage</td>
                                    <td class="amount-col">$2,300.00</td>
                                    <td class="amount-col">$1,250.00</td>
                                    <td class="amount-col">$4,750.00</td>
                                    <td class="amount-col">$8,300.00</td>
                                </tr>
                                <tr>
                                    <td>Insurance</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$8,150.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$8,150.00</td>
                                </tr>
                                <tr>
                                    <td>Technology</td>
                                    <td class="amount-col">$2,250.00</td>
                                    <td class="amount-col">$1,250.00</td>
                                    <td class="amount-col">$1,150.00</td>
                                    <td class="amount-col">$4,650.00</td>
                                </tr>
                                <tr>
                                    <td>Events and Meetings</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$0.00</td>
                                    <td class="amount-col">$3,015.00</td>
                                    <td class="amount-col">$3,015.00</td>
                                </tr>
                                <tr class="total-row">
                                    <td>Total Expenses</td>
                                    <td class="amount-col">$285,450.00</td>
                                    <td class="amount-col">$98,750.00</td>
                                    <td class="amount-col">$67,240.00</td>
                                    <td class="amount-col">$451,440.00</td>
                                </tr>
                                <tr>
                                    <td>Percent of Total</td>
                                    <td class="amount-col">63.2%</td>
                                    <td class="amount-col">21.9%</td>
                                    <td class="amount-col">14.9%</td>
                                    <td class="amount-col">100.0%</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="report-footer">
                            Unaudited - For Management Purposes Only
                        </div>
                    </div>
                </div>
                
                <!-- Budget vs. Actual Report -->
                <div id="budget-vs-actual-report" class="report-view">
                    <div class="report-actions">
                        <button class="btn-secondary" data-action="back-to-gallery">Back to Reports</button>
                        <div class="report-filters">
                            <div class="filter-group">
                                <label>Fund:</label>
                                <select class="form-input">
                                    <option value="all">All Funds</option>
                                    <option value="gen">General Operating</option>
                                    <option value="prog">Program Services</option>
                                    <option value="bldg">Building Fund</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Period:</label>
                                <select class="form-input">
                                    <option value="ytd">Year to Date</option>
                                    <option value="q4">Q4 (Apr-Jun)</option>
                                    <option value="q3">Q3 (Jan-Mar)</option>
                                    <option value="q2">Q2 (Oct-Dec)</option>
                                    <option value="q1">Q1 (Jul-Sep)</option>
                                </select>
                            </div>
                        </div>
                        <div class="report-tools">
                            <button class="action-button">Print</button>
                            <button class="action-button">Export PDF</button>
                            <button class="action-button">Export Excel</button>
                        </div>
                    </div>
                    
                    <div class="report-container">
                        <div class="report-header">
                            <div class="report-title">Community Nonprofit Foundation</div>
                            <div class="report-subtitle">Budget vs. Actual</div>
                            <div class="report-date">For the Year Ended June 30, 2025</div>
                        </div>
                        
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>Account</th>
                                    <th class="amount-col">Budget</th>
                                    <th class="amount-col">Actual</th>
                                    <th class="amount-col">$ Variance</th>
                                    <th class="amount-col">% Variance</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Revenue Section -->
                                <tr class="section-header">
                                    <td colspan="5">Revenue</td>
                                </tr>
                                <tr>
                                    <td>Individual Contributions</td>
                                    <td class="amount-col">$175,000.00</td>
                                    <td class="amount-col">$187,450.00</td>
                                    <td class="amount-col">$12,450.00</td>
                                    <td class="amount-col">7.1%</td>
                                </tr>
                                <tr>
                                    <td>Foundation Grants</td>
                                    <td class="amount-col">$250,000.00</td>
                                    <td class="amount-col">$232,550.00</td>
                                    <td class="amount-col">($17,450.00)</td>
                                    <td class="amount-col">-7.0%</td>
                                </tr>
                                <tr>
                                    <td>Program Service Fees</td>
                                    <td class="amount-col">$95,000.00</td>
                                    <td class="amount-col">$85,450.00</td>
                                    <td class="amount-col">($9,550.00)</td>
                                    <td class="amount-col">-10.1%</td>
                                </tr>
                                <tr>
                                    <td>Special Events</td>
                                    <td class="amount-col">$50,000.00</td>
                                    <td class="amount-col">$42,000.00</td>
                                    <td class="amount-col">($8,000.00)</td>
                                    <td class="amount-col">-16.0%</td>
                                </tr>
                                <tr>
                                    <td>Investment Income</td>
                                    <td class="amount-col">$15,000.00</td>
                                    <td class="amount-col">$20,440.00</td>
                                    <td class="amount-col">$5,440.00</td>
                                    <td class="amount-col">36.3%</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Revenue</td>
                                    <td class="amount-col">$585,000.00</td>
                                    <td class="amount-col">$567,890.00</td>
                                    <td class="amount-col">($17,110.00)</td>
                                    <td class="amount-col">-2.9%</td>
                                </tr>
                                
                                <!-- Expenses Section -->
                                <tr class="section-header">
                                    <td colspan="5">Expenses</td>
                                </tr>
                                <tr>
                                    <td>Program Services</td>
                                    <td class="amount-col">$300,000.00</td>
                                    <td class="amount-col">$285,450.00</td>
                                    <td class="amount-col">$14,550.00</td>
                                    <td class="amount-col">4.9%</td>
                                </tr>
                                <tr>
                                    <td>Management and General</td>
                                    <td class="amount-col">$110,000.00</td>
                                    <td class="amount-col">$98,750.00</td>
                                    <td class="amount-col">$11,250.00</td>
                                    <td class="amount-col">10.2%</td>
                                </tr>
                                <tr>
                                    <td>Fundraising</td>
                                    <td class="amount-col">$75,000.00</td>
                                    <td class="amount-col">$67,240.00</td>
                                    <td class="amount-col">$7,760.00</td>
                                    <td class="amount-col">10.3%</td>
                                </tr>
                                <tr class="subtotal-row">
                                    <td>Total Expenses</td>
                                    <td class="amount-col">$485,000.00</td>
                                    <td class="amount-col">$451,440.00</td>
                                    <td class="amount-col">$33,560.00</td>
                                    <td class="amount-col">6.9%</td>
                                </tr>
                                
                                <!-- Net Income -->
                                <tr class="total-row">
                                    <td>Net Surplus/(Deficit)</td>
                                    <td class="amount-col">$100,000.00</td>
                                    <td class="amount-col">$116,450.00</td>
                                    <td class="amount-col">$16,450.00</td>
                                    <td class="amount-col">16.5%</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="report-footer">
                            Unaudited - For Management Purposes Only
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Page (hidden by default) -->
            <div id="settings-page" class="page" style="display:none;">
                <div class="content-header">
                    <h2>System Settings</h2>
                </div>
                
                <div class="tab-container">
                    <div class="tab-menu">
                        <div class="tab-item active" data-tab="users-tab">Users</div>
                        <div class="tab-item" data-tab="organization-tab">Organization</div>
                        <div class="tab-item" data-tab="fiscal-years-tab">Fiscal Years</div>
                    </div>
                    <div class="tab-content">
                        <div id="users-tab" class="tab-panel active">
                            <div class="content-header">
                                <h3>User Management</h3>
                                <button class="action-button">Add User</button>
                            </div>
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>John Doe</td>
                                        <td>john.doe@example.org</td>
                                        <td>Administrator</td>
                                        <td>Active</td>
                                        <td><button class="action-button">Edit</button></td>
                                    </tr>
                                    <tr>
                                        <td>Mary Johnson</td>
                                        <td>mary.johnson@example.org</td>
                                        <td>Finance Manager</td>
                                        <td>Active</td>
                                        <td><button class="action-button">Edit</button></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div id="organization-tab" class="tab-panel">
                            <div class="content-header">
                                <h3>Organization Settings</h3>
                                <button class="action-button">Save Changes</button>
                            </div>
                            
                            <div class="form-section">
                                <h4>General Information</h4>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Organization Name</label>
                                            <input type="text" class="form-input" value="Community Nonprofit Foundation" />
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">EIN / Tax ID</label>
                                            <input type="text" class="form-input" value="12-3456789" />
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Phone Number</label>
                                            <input type="tel" class="form-input" value="(555) 123-4567" />
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Email Address</label>
                                            <input type="email" class="form-input" value="info@communitynp.org" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4>Address</h4>
                                <div class="form-group">
                                    <label class="form-label">Street Address</label>
                                    <input type="text" class="form-input" value="123 Nonprofit Way" />
                                </div>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">City</label>
                                            <input type="text" class="form-input" value="Communityville" />
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">State</label>
                                            <input type="text" class="form-input" value="CA" />
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">ZIP Code</label>
                                            <input type="text" class="form-input" value="90210" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4>Financial Settings</h4>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Default Currency</label>
                                            <select class="form-input">
                                                <option selected>USD - US Dollar</option>
                                                <option>CAD - Canadian Dollar</option>
                                                <option>EUR - Euro</option>
                                                <option>GBP - British Pound</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Currency Display</label>
                                            <select class="form-input">
                                                <option selected>$1,234.56</option>
                                                <option>1,234.56 USD</option>
                                                <option>USD 1,234.56</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Financial Statement Precision</label>
                                            <select class="form-input">
                                                <option>0 decimals ($1,235)</option>
                                                <option selected>2 decimals ($1,234.56)</option>
                                                <option>4 decimals ($1,234.5678)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Transaction Entry Precision</label>
                                            <select class="form-input">
                                                <option>0 decimals ($1,235)</option>
                                                <option selected>2 decimals ($1,234.56)</option>
                                                <option>4 decimals ($1,234.5678)</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4>System Settings</h4>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Default Login Page</label>
                                            <select class="form-input">
                                                <option selected>Dashboard</option>
                                                <option>Chart of Accounts</option>
                                                <option>Funds</option>
                                                <option>Journal Entries</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Session Timeout (minutes)</label>
                                            <input type="number" class="form-input" value="30" min="5" max="120" />
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Organization Logo</label>
                                    <input type="file" class="form-input" />
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button class="btn-secondary">Cancel</button>
                                <button class="action-button">Save Changes</button>
                            </div>
                        </div>
                        <div id="fiscal-years-tab" class="tab-panel">
                            <div class="content-header">
                                <h3>Fiscal Year Management</h3>
                                <button class="action-button">Add Fiscal Year</button>
                            </div>
                            
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Fiscal Year</th>
                                        <th>Start Date</th>
                                        <th>End Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>FY2025</td>
                                        <td>07/01/2024</td>
                                        <td>06/30/2025</td>
                                        <td>Current</td>
                                        <td>
                                            <button class="action-button">Edit</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>FY2024</td>
                                        <td>07/01/2023</td>
                                        <td>06/30/2024</td>
                                        <td>Closed</td>
                                        <td>
                                            <button class="action-button">View</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>FY2023</td>
                                        <td>07/01/2022</td>
                                        <td>06/30/2023</td>
                                        <td>Closed</td>
                                        <td>
                                            <button class="action-button">View</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <div id="fiscal-year-form" style="margin-top: 30px; border-top: 1px solid #ddd; padding-top: 20px;">
                                <h4>Add New Fiscal Year</h4>
                                
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Fiscal Year Name</label>
                                            <input type="text" class="form-input" placeholder="e.g., FY2026" />
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Fiscal Year Code</label>
                                            <input type="text" class="form-input" placeholder="e.g., 2026" />
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">Start Date</label>
                                            <input type="date" class="form-input" value="2025-07-01" />
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label class="form-label">End Date</label>
                                            <input type="date" class="form-input" value="2026-06-30" />
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>Period Configuration</h4>
                                    <div class="form-row">
                                        <div class="form-column">
                                            <div class="form-group">
                                                <label class="form-label">Number of Periods</label>
                                                <select class="form-input">
                                                    <option>4 (Quarterly)</option>
                                                    <option selected>12 (Monthly)</option>
                                                    <option>13 (4-4-5)</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="form-column">
                                            <div class="form-group">
                                                <label class="form-label">Period Naming</label>
                                                <select class="form-input">
                                                    <option selected>Month Names (January, February, etc.)</option>
                                                    <option>Period Numbers (Period 1, Period 2, etc.)</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-section">
                                    <h4>Options</h4>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" checked /> Create periods automatically
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" checked /> Copy chart of accounts from previous fiscal year
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" /> Copy budget data from previous fiscal year
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-actions">
                                    <button class="btn-secondary">Cancel</button>
                                    <button class="action-button">Create Fiscal Year</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Other pages would be added here -->
        </div>
    </div>

    <!-- Modal Dialogs -->
    <div id="account-modal" class="modal-overlay">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Add New Account</h3>
                <button class="modal-close" data-action="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Account Code</label>
                            <input type="text" class="form-input" placeholder="e.g., 1000">
                        </div>
                    </div>
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Account Name</label>
                            <input type="text" class="form-input" placeholder="e.g., Cash and Cash Equivalents">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Account Type</label>
                            <select class="form-input">
                                <option value="asset">Asset</option>
                                <option value="liability">Liability</option>
                                <option value="equity">Equity</option>
                                <option value="revenue">Revenue</option>
                                <option value="expense">Expense</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-input">
                                <option value="active" selected>Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" rows="3" placeholder="Optional description of this account..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" data-action="close-modal">Cancel</button>
                <button class="action-button">Save Account</button>
            </div>
        </div>
    </div>

    <div id="fund-modal" class="modal-overlay">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Add New Fund</h3>
                <button class="modal-close" data-action="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Fund Code</label>
                            <input type="text" class="form-input" placeholder="e.g., GEN">
                        </div>
                    </div>
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Fund Name</label>
                            <input type="text" class="form-input" placeholder="e.g., General Operating Fund">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Restriction Type</label>
                            <select class="form-input">
                                <option value="unrestricted">Unrestricted</option>
                                <option value="temporarily">Temporarily Restricted</option>
                                <option value="permanently">Permanently Restricted</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-input">
                                <option value="active" selected>Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" rows="3" placeholder="Optional description of this fund..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" data-action="close-modal">Cancel</button>
                <button class="action-button">Save Fund</button>
            </div>
        </div>
    </div>

    <div id="journal-entry-modal" class="modal-overlay">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">Create Journal Entry</h3>
                <button class="modal-close" data-action="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-row">
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Date</label>
                            <input type="date" class="form-input" value="">
                        </div>
                    </div>
                    <div class="form-column">
                        <div class="form-group">
                            <label class="form-label">Reference</label>
                            <input type="text" class="form-input" value="JE-2025-0149" readonly>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <input type="text" class="form-input" placeholder="Enter transaction description...">
                </div>
                
                <h4 style="margin: 20px 0 10px 0;">Journal Entry Lines</h4>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Account</th>
                            <th>Fund</th>
                            <th>Debit</th>
                            <th>Credit</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody id="journal-lines">
                        <tr>
                            <td>
                                <select class="form-input">
                                    <option value="">Select Account</option>
                                    <option value="1000">1000 - Cash and Cash Equivalents</option>
                                    <option value="1100">1100 - Accounts Receivable</option>
                                    <option value="2000">2000 - Accounts Payable</option>
                                    <option value="4000">4000 - Grant Revenue</option>
                                </select>
                            </td>
                            <td>
                                <select class="form-input">
                                    <option value="">Select Fund</option>
                                    <option value="GEN">GEN - General Operating Fund</option>
                                    <option value="PROG">PROG - Program Services Fund</option>
                                    <option value="BLDG">BLDG - Building Fund</option>
                                </select>
                            </td>
                            <td><input type="number" step="0.01" class="form-input" placeholder="0.00"></td>
                            <td><input type="number" step="0.01" class="form-input" placeholder="0.00"></td>
                            <td><input type="text" class="form-input" placeholder="Line description"></td>
                        </tr>
                        <tr>
                            <td>
                                <select class="form-input">
                                    <option value="">Select Account</option>
                                    <option value="1000">1000 - Cash and Cash Equivalents</option>
                                    <option value="1100">1100 - Accounts Receivable</option>
                                    <option value="2000">2000 - Accounts Payable</option>
                                    <option value="4000">4000 - Grant Revenue</option>
                                </select>
                            </td>
                            <td>
                                <select class="form-input">
                                    <option value="">Select Fund</option>
                                    <option value="GEN">GEN - General Operating Fund</option>
                                    <option value="PROG">PROG - Program Services Fund</option>
                                    <option value="BLDG">BLDG - Building Fund</option>
                                </select>
                            </td>
                            <td><input type="number" step="0.01" class="form-input" placeholder="0.00"></td>
                            <td><input type="number" step="0.01" class="form-input" placeholder="0.00"></td>
                            <td><input type="text" class="form-input" placeholder="Line description"></td>
                        </tr>
                    </tbody>
                </table>
                <button id="add-line" class="btn-secondary" style="margin-top: 10px;">Add Line</button>
                
                <div class="form-row" style="margin-top: 20px; justify-content: flex-end;">
                    <div class="form-column" style="flex: 0 0 auto; min-width: 120px;">
                        <div class="form-group">
                            <label class="form-label">Total Debits</label>
                            <input type="text" class="form-input" value="$0.00" readonly>
                        </div>
                    </div>
                    <div class="form-column" style="flex: 0 0 auto; min-width: 120px;">
                        <div class="form-group">
                            <label class="form-label">Total Credits</label>
                            <input type="text" class="form-input" value="$0.00" readonly>
                        </div>
                    </div>
                    <div class="form-column" style="flex: 0 0 auto; min-width: 120px;">
                        <div class="form-group">
                            <label class="form-label">Difference</label>
                            <input type="text" class="form-input" value="$0.00" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" data-action="close-modal">Cancel</button>
                <button class="action-button">Save as Draft</button>
                <button class="action-button">Save & Post</button>
            </div>
        </div>
    </div>

    <!-- Add this at the end of the body, after the other modals -->
    <div id="drill-down-modal" class="modal-overlay drill-down-modal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span class="title">Account Details</span>
                    <span class="amount"></span>
                </h3>
                <button class="modal-close" data-action="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="drill-down-path">
                    <span id="drill-path"></span>
                </div>
                
                <table class="data-table">
                    <thead id="drill-down-headers">
                        <!-- Headers will be inserted dynamically -->
                    </thead>
                    <tbody id="drill-down-data">
                        <!-- Data will be inserted dynamically -->
                    </tbody>
                </table>
                
                <div id="drill-down-summary" class="mt-20" style="text-align: right;">
                    <!-- Summary will be inserted dynamically -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" data-action="close-modal">Close</button>
                <button class="action-button" id="export-drill-data">Export</button>
            </div>
        </div>
    </div>

    <!-- Report Builder Modal -->
    <div id="report-builder-modal" class="modal-overlay">
        <div class="modal-dialog" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">Custom Report Builder</h3>
                <button class="modal-close" data-action="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Report Definition Section -->
                <div class="form-section">
                    <h4>Report Information</h4>
                    <div class="form-row">
                        <div class="form-column">
                            <div class="form-group">
                                <label class="form-label">Report Name</label>
                                <input type="text" id="report-name" class="form-input" placeholder="e.g., Monthly Program Expenses">
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label class="form-label">Report Type</label>
                                <select id="report-type" class="form-input">
                                    <option value="financial">Financial Statement</option>
                                    <option value="transaction">Transaction List</option>
                                    <option value="summary">Summary Report</option>
                                    <option value="comparison">Comparison Report</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Report Description</label>
                        <textarea id="report-description" class="form-input" rows="2" placeholder="Describe the purpose of this report..."></textarea>
                    </div>
                </div>
                
                <!-- Field Selection Section -->
                <div class="form-section">
                    <h4>Fields</h4>
                    <div class="form-row">
                        <!-- Available Fields Column -->
                        <div class="form-column">
                            <div class="form-group">
                                <label class="form-label">Available Fields</label>
                                <div class="field-selector" id="available-fields">
                                    <div class="field-item" data-field="date">Date</div>
                                    <div class="field-item" data-field="account">Account</div>
                                    <div class="field-item" data-field="account_code">Account Code</div>
                                    <div class="field-item" data-field="fund">Fund</div>
                                    <div class="field-item" data-field="fund_code">Fund Code</div>
                                    <div class="field-item" data-field="description">Description</div>
                                    <div class="field-item" data-field="reference">Reference</div>
                                    <div class="field-item" data-field="debit">Debit</div>
                                    <div class="field-item" data-field="credit">Credit</div>
                                    <div class="field-item" data-field="amount">Amount</div>
                                    <div class="field-item" data-field="program">Program</div>
                                    <div class="field-item" data-field="created_by">Created By</div>
                                    <div class="field-item" data-field="status">Status</div>
                                    <div class="field-item" data-field="budget">Budget</div>
                                    <div class="field-item" data-field="actual">Actual</div>
                                    <div class="field-item" data-field="variance">Variance</div>
                                    <div class="field-item" data-field="variance_percent">Variance %</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Selected Fields Column -->
                        <div class="form-column">
                            <div class="form-group">
                                <label class="form-label">Selected Fields</label>
                                <div class="selected-fields-container" id="selected-fields">
                                    <div class="preview-placeholder">Drag or click fields from the left to add them to your report</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Filters Section -->
                <div class="form-section">
                    <h4>Filters</h4>
                    <div id="filter-container">
                        <div class="filter-row">
                            <select class="form-input" style="width: 200px;">
                                <option>Select Field...</option>
                                <option>Date</option>
                                <option>Account</option>
                                <option>Fund</option>
                                <option>Amount</option>
                            </select>
                            <select class="form-input" style="width: 180px;">
                                <option>Equal To</option>
                                <option>Not Equal To</option>
                                <option>Greater Than</option>
                                <option>Less Than</option>
                                <option>Contains</option>
                                <option>Starts With</option>
                            </select>
                            <input type="text" class="form-input" placeholder="Value" style="flex-grow: 1;">
                            <button class="btn-secondary">Remove</button>
                        </div>
                    </div>
                    <button id="add-filter" class="btn-secondary mt-20">Add Filter</button>
                </div>
                
                <!-- Sorting & Grouping -->
                <div class="form-section">
                    <h4>Sorting & Grouping</h4>
                    <div class="form-row">
                        <div class="form-column">
                            <div class="form-group">
                                <label class="form-label">Sort By</label>
                                <select id="sort-field" class="form-input">
                                    <option value="">Select a field...</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label class="form-label">Sort Order</label>
                                <select id="sort-order" class="form-input">
                                    <option value="asc">Ascending</option>
                                    <option value="desc">Descending</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Group By</label>
                        <select id="group-field" class="form-input">
                            <option value="">None (Detail View)</option>
                        </select>
                    </div>
                </div>
                
                <!-- Preview Section -->
                <div class="form-section">
                    <h4>Report Preview</h4>
                    <div class="report-preview" id="report-preview">
                        <div class="preview-placeholder">Preview will be generated when fields are selected</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" data-action="close-modal">Cancel</button>
                <button class="btn-secondary" id="btn-save-as-draft">Save as Draft</button>
                <button class="action-button" id="btn-create-report">Create Report</button>
            </div>
        </div>
    </div>

    <script>
        // Globally defined helper functions for modals
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'flex';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

/**
 * Re-uses the existing add-record modals for Edit / View.
 *  - modalId â€¦â€¦ which modal to show (account-modal, fund-modal, journal-entry-modal)
 *  - rowData â€¦  key/value object with data from the clicked row
 *  - isEdit â€¦   true â‡’ â€œEdit â€¦â€ title, false â‡’ â€œAdd â€¦â€
 */
function setupEditModal(modalId, rowData = {}, isEdit = false) {
    const modal = document.getElementById(modalId);
    if (!modal) return;

    /* ----- 1.  Set correct title  --------------------------------------- */
    const t = modal.querySelector('.modal-title');
    if (t) {
        if (!isEdit) {
            t.textContent =
                modalId === 'account-modal'       ? 'Add New Account'      :
                modalId === 'fund-modal'          ? 'Add New Fund'         :
                /* journal */                       'Create Journal Entry';
        } else {
            t.textContent =
                modalId === 'account-modal'       ? 'Edit Account'         :
                modalId === 'fund-modal'          ? 'Edit Fund'            :
                /* journal */                       'Edit Journal Entry';
        }
    }

    /* ----- 2.  Populate simple fields for Account / Fund  --------------- */
    if (isEdit && Object.keys(rowData).length > 0) {
        if (modalId === 'account-modal') {
            const [code, name]      = modal.querySelectorAll('.form-input');
            code.value  = rowData.code  || '';
            name.value  = rowData.name  || '';
            /* type dropdown */
            const typeSel = modal.querySelector('select.form-input');
            [...typeSel.options].forEach(o => {
                if (o.textContent.toLowerCase().includes(rowData.type.toLowerCase()))
                    typeSel.value = o.value;
            });
        } else if (modalId === 'fund-modal') {
            const inputs = modal.querySelectorAll('.form-input');
            inputs[0].value = rowData.code  || '';
            inputs[1].value = rowData.name  || '';
            /* restriction type dropdown (inputs[2]) */
            [...inputs[2].options].forEach(o => {
                if (o.textContent.toLowerCase().includes(rowData.type.toLowerCase()))
                    inputs[2].value = o.value;
            });
            /* status dropdown (inputs[3]) */
            inputs[3].value = rowData.status?.toLowerCase() === 'inactive' ? 'inactive' : 'active';
        }
        /* Journal-entry editing could be implemented similarly later */
    }

    openModal(modalId);
}

        // Drill-down functionality
        function setupDrillDownFunctionality() {
            // Make balance sheet amounts drillable
            setupDrillable('#financial-position-report .report-table tbody td.amount-col:not(.total-row td)', 'account');
            
            // Make statement of activities amounts drillable
            setupDrillable('#activities-report .report-table tbody td.amount-col:not(.total-row td):not(.subtotal-row td)', 'activities');
            
            // Make functional expenses amounts drillable
            setupDrillable('#functional-expenses-report .report-table tbody td.amount-col:not(.total-row td)', 'expense');
            
            // Make budget vs actual amounts drillable
            setupDrillable('#budget-vs-actual-report .report-table tbody td.amount-col:not(:last-child):not(.total-row td):not(.subtotal-row td)', 'budget');
        }

        function setupDrillable(selector, dataType) {
            document.querySelectorAll(selector).forEach(cell => {
                // Don't make $0.00 amounts drillable
                if (cell.textContent.trim() === '$0.00' || cell.textContent.trim() === '($0.00)') return;
                
                cell.classList.add('drillable');
                cell.addEventListener('click', function() {
                    // Get the context of this cell
                    const row = this.closest('tr');
                    const rowLabel = row.cells[0].textContent.trim();
                    const amount = this.textContent.trim();
                    const reportContainer = this.closest('.report-container');
                    const reportHeader = reportContainer ? reportContainer.querySelector('.report-subtitle').textContent.trim() : 'Report';
                    
                    // Show the drill-down modal with appropriate data
                    showDrillDown(dataType, rowLabel, amount, reportHeader);
                });
            });
        }

        function showDrillDown(dataType, label, amount, reportHeader) {
            // Get references to the modal elements
            const modal = document.getElementById('drill-down-modal');
            const titleElement = modal.querySelector('.modal-title .title');
            const amountElement = modal.querySelector('.modal-title .amount');
            const pathElement = document.getElementById('drill-path');
            const headersElement = document.getElementById('drill-down-headers');
            const dataElement = document.getElementById('drill-down-data');
            const summaryElement = document.getElementById('drill-down-summary');
            
            // Set the title and amount
            titleElement.textContent = label;
            amountElement.textContent = amount;
            pathElement.innerHTML = `<span>${reportHeader}</span> &gt; <span>${label}</span>`;
            
            // Clear previous content
            headersElement.innerHTML = '';
            dataElement.innerHTML = '';
            summaryElement.innerHTML = '';
            
            // Create different content based on data type
            if (dataType === 'account') {
                // For account balances, show transactions
                const headerRow = document.createElement('tr');
                headerRow.innerHTML = `
                    <th>Date</th>
                    <th>Reference</th>
                    <th>Description</th>
                    <th>Fund</th>
                    <th class="amount-col">Debit</th>
                    <th class="amount-col">Credit</th>
                    <th class="amount-col">Balance</th>
                `;
                headersElement.appendChild(headerRow);
                
                // Generate sample transaction data
                const transactions = generateSampleTransactions(label, amount);
                transactions.forEach(t => {
                    const dataRow = document.createElement('tr');
                    dataRow.innerHTML = `
                        <td>${t.date}</td>
                        <td>${t.reference}</td>
                        <td>${t.description}</td>
                        <td>${t.fund}</td>
                        <td class="amount-col">${t.debit}</td>
                        <td class="amount-col">${t.credit}</td>
                        <td class="amount-col">${t.balance}</td>
                    `;
                    dataElement.appendChild(dataRow);
                });
                
                // Add summary
                summaryElement.innerHTML = `
                    <strong>Total: ${amount}</strong>
                `;
            } else if (dataType === 'activities') {
                // For activities, show fund breakdown
                const headerRow = document.createElement('tr');
                headerRow.innerHTML = `
                    <th>Fund</th>
                    <th>Description</th>
                    <th class="amount-col">Amount</th>
                    <th>Date</th>
                `;
                headersElement.appendChild(headerRow);
                
                // Generate sample fund breakdown
                const funds = generateSampleFundBreakdown(label, amount);
                funds.forEach(f => {
                    const dataRow = document.createElement('tr');
                    dataRow.innerHTML = `
                        <td>${f.fund}</td>
                        <td>${f.description}</td>
                        <td class="amount-col">${f.amount}</td>
                        <td>${f.date}</td>
                    `;
                    dataElement.appendChild(dataRow);
                });
                
                // Add summary
                summaryElement.innerHTML = `
                    <strong>Total ${label}: ${amount}</strong>
                `;
            } else if (dataType === 'expense') {
                // For expenses, show vendor breakdown
                const headerRow = document.createElement('tr');
                headerRow.innerHTML = `
                    <th>Vendor/Payee</th>
                    <th>Date</th>
                    <th>Reference</th>
                    <th>Description</th>
                    <th class="amount-col">Amount</th>
                `;
                headersElement.appendChild(headerRow);
                
                // Generate sample vendor data
                const vendors = generateSampleVendorBreakdown(label, amount);
                vendors.forEach(v => {
                    const dataRow = document.createElement('tr');
                    dataRow.innerHTML = `
                        <td>${v.vendor}</td>
                        <td>${v.date}</td>
                        <td>${v.reference}</td>
                        <td>${v.description}</td>
                        <td class="amount-col">${v.amount}</td>
                    `;
                    dataElement.appendChild(dataRow);
                });
                
                // Add summary
                summaryElement.innerHTML = `
                    <strong>Total ${label}: ${amount}</strong>
                `;
            } else if (dataType === 'budget') {
                // For budget, show monthly breakdown
                const headerRow = document.createElement('tr');
                headerRow.innerHTML = `
                    <th>Month</th>
                    <th class="amount-col">Budget</th>
                    <th class="amount-col">Actual</th>
                    <th class="amount-col">Variance</th>
                    <th class="amount-col">% Variance</th>
                `;
                headersElement.appendChild(headerRow);
                
                // Generate sample monthly data
                const months = generateSampleMonthlyBreakdown(label, amount);
                months.forEach(m => {
                    const dataRow = document.createElement('tr');
                    dataRow.innerHTML = `
                        <td>${m.month}</td>
                        <td class="amount-col">${m.budget}</td>
                        <td class="amount-col">${m.actual}</td>
                        <td class="amount-col">${m.variance}</td>
                        <td class="amount-col">${m.percentVariance}</td>
                    `;
                    dataElement.appendChild(dataRow);
                });
                
                // Add summary
                summaryElement.innerHTML = `
                    <strong>Year to Date: ${amount}</strong>
                `;
            }
            
            // Show the modal
            openModal('drill-down-modal');
        }

        function addJournalLine() {
            const linesContainer = document.getElementById('journal-lines');
            const newLine = document.createElement('tr');
            newLine.innerHTML = `
                <td>
                    <select class="form-input">
                        <option value="">Select Account</option>
                        <option value="1000">1000 - Cash and Cash Equivalents</option>
                        <option value="1100">1100 - Accounts Receivable</option>
                        <option value="2000">2000 - Accounts Payable</option>
                        <option value="4000">4000 - Grant Revenue</option>
                    </select>
                </td>
                <td>
                    <select class="form-input">
                        <option value="">Select Fund</option>
                        <option value="GEN">GEN - General Operating Fund</option>
                        <option value="PROG">PROG - Program Services Fund</option>
                        <option value="BLDG">BLDG - Building Fund</option>
                    </select>
                </td>
                <td><input type="number" step="0.01" class="form-input" placeholder="0.00"></td>
                <td><input type="number" step="0.01" class="form-input" placeholder="0.00"></td>
                <td><input type="text" class="form-input" placeholder="Line description"></td>
            `;
            linesContainer.appendChild(newLine);
        }
        
        function setJournalEntryDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.querySelector('#journal-entry-modal input[type="date"]');
            if (dateInput) {
                dateInput.value = today;
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Main navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.nav-item').forEach(navItem => navItem.classList.remove('active'));
                    this.classList.add('active');
                    document.querySelectorAll('.page').forEach(page => page.style.display = 'none');
                    const pageId = this.getAttribute('data-page') + '-page';
                    const pageElement = document.getElementById(pageId);
                    if (pageElement) pageElement.style.display = 'block';

                    const quickActionsContainer = document.getElementById('quick-actions-container');
                    const pageActionsContainer = document.getElementById('page-actions-container');
                    if (pageId === 'dashboard-page') {
                        quickActionsContainer.style.display = 'block';
                        pageActionsContainer.style.display = 'none';
                    } else {
                        quickActionsContainer.style.display = 'none';
                        pageActionsContainer.style.display = 'block';
                    }
                });
            });
            
            // Sidebar navigation
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.sidebar-item').forEach(sideItem => sideItem.classList.remove('active'));
                    this.classList.add('active');
                    if (document.getElementById('dashboard-page').classList.contains('active')) {
                        document.querySelectorAll('.dashboard-panel').forEach(panel => panel.classList.remove('active'));
                        const panelId = this.getAttribute('data-panel');
                        const panelElement = document.getElementById(panelId);
                        if (panelElement) panelElement.classList.add('active');
                    }
                });
            });
            
            // Tab handling
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabContainer = this.closest('.tab-container');
                    tabContainer.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                    tabContainer.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
                    const panelId = this.getAttribute('data-tab');
                    const panelElement = document.getElementById(panelId);
                    if (panelElement) panelElement.classList.add('active');
                });
            });

            // Report generation buttons
            document.querySelectorAll('.card .action-button[data-report]').forEach(button => {
                button.addEventListener('click', function() {
                    const reportType = this.getAttribute('data-report');
                    showReport(reportType);
                });
            });
            
            // Back to gallery buttons
            document.querySelectorAll('button[data-action=\"back-to-gallery\"]').forEach(button => {
                button.addEventListener('click', function() {
                    hideAllReports();
                    document.getElementById('reports-gallery').style.display = 'block';
                });
            });
            
            function showReport(reportType) {
                hideAllReports();
                const reportElement = document.getElementById(`${reportType}-report`);
                if (reportElement) {
                    reportElement.style.display = 'block';
                }
                setupDrillDownFunctionality(); // Add drill-down to the newly shown report
            }
            
            function hideAllReports() {
                document.getElementById('reports-gallery').style.display = 'none';
                document.querySelectorAll('.report-view').forEach(report => {
                    report.style.display = 'none';
                });
            }

            // Modal trigger button listeners
            const addAccountBtn = document.getElementById('btn-add-account');
            if (addAccountBtn) {
                addAccountBtn.addEventListener('click', () => setupEditModal('account-modal', {}, false));
            }

            const addFundBtn = document.getElementById('btn-add-fund');
            if (addFundBtn) {
                addFundBtn.addEventListener('click', () => setupEditModal('fund-modal', {}, false));
            }

            const newEntryBtn = document.getElementById('btn-new-journal-entry');
            if (newEntryBtn) {
                newEntryBtn.addEventListener('click', () => {
                    setJournalEntryDate();
                    setupEditModal('journal-entry-modal', {}, false);
                });
            }

            // Close modal buttons
            document.querySelectorAll('[data-action="close-modal"]').forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal-overlay');
                    if (modal) {
                        closeModal(modal.id);
                    }
                });
            });

            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });

            // Journal entry "Add Line" listener
            const addLineBtn = document.getElementById('add-line');
            if(addLineBtn) {
                addLineBtn.addEventListener('click', addJournalLine);
            }

            /* ------------------------------------------------------------------
               Attach Edit / View listeners for each table that has action buttons
               ------------------------------------------------------------------*/

            // Chart-of-Accounts  â–º Edit
            document.querySelectorAll(
              '#chart-of-accounts-page .data-table .action-button'
            ).forEach(btn => {
                if (btn.textContent.trim() === 'Edit') {
                    btn.addEventListener('click', function () {
                        const row = this.closest('tr');
                        if (!row) return;
                        const [code, name, type, balanceCell, statusCell] = row.cells;
                        const statusTxt = statusCell.querySelector('.status')
                            ? statusCell.querySelector('.status').textContent.trim()
                            : statusCell.textContent.trim();

                        setupEditModal('account-modal',
                            {
                                code   : code.textContent.trim(),
                                name   : name.textContent.trim(),
                                type   : type.textContent.trim(),
                                balance: balanceCell.textContent.trim(),
                                status : statusTxt
                            },
                            true);
                    });
                }
            });

            // Funds  â–º Edit
            document.querySelectorAll(
              '#funds-page .data-table .action-button'
            ).forEach(btn => {
                if (btn.textContent.trim() === 'Edit') {
                    btn.addEventListener('click', function () {
                        const row = this.closest('tr');
                        if (!row) return;
                        const [code, name, type, balanceCell, statusCell] = row.cells;
                        setupEditModal('fund-modal',
                            {
                                code   : code.textContent.trim(),
                                name   : name.textContent.trim(),
                                type   : type.textContent.trim(),
                                balance: balanceCell.textContent.trim(),
                                status : statusCell.textContent.trim()
                            },
                            true);
                    });
                }
            });

            // Journal-Entries  â–º View (opens as read-only Edit for now)
            document.querySelectorAll(
              '#journal-entries-page .data-table .action-button'
            ).forEach(btn => {
                if (btn.textContent.trim() === 'View') {
                    btn.addEventListener('click', function () {
                        const row = this.closest('tr');
                        if (!row) return;
                        const [date, reference, description, amount, statusCell, createdBy] = row.cells;
                        setupEditModal('journal-entry-modal',
                            {
                                date       : date.textContent.trim(),
                                reference  : reference.textContent.trim(),
                                description: description.textContent.trim(),
                                amount     : amount.textContent.trim(),
                                status     : statusCell.textContent.trim(),
                                createdBy  : createdBy.textContent.trim()
                            },
                            true);
                    });
                }
            });

            // Settings â–¸ User-Management â€‘ Edit placeholder
            document.querySelectorAll(
              '#users-tab .data-table .action-button'
            ).forEach(btn => {
                if (btn.textContent.trim() === 'Edit') {
                    btn.addEventListener('click', () => {
                        alert('User edit functionality coming soon.');
                    });
                }
            });

            // Settings â–¸ Fiscal-Years  â€“ Edit / View placeholder
            document.querySelectorAll(
              '#fiscal-years-tab .data-table .action-button'
            ).forEach(btn => {
                btn.addEventListener('click', () => {
                    alert('Fiscal-year ' + btn.textContent.trim().toLowerCase() +
                          ' functionality coming soon.');
                });
            });

            // -----------------------------------------------------------------
            // Enable drill-down on any report that might already be visible
            // -----------------------------------------------------------------
            setupDrillDownFunctionality();

            // Initial page load (default to dashboard)
            loadPage('dashboard'); 
        });

        // Function to load content based on page (needs to be defined for initial load)
        function loadPage(pageId) {
            const mainContent = document.getElementById('main-content');
            if (!mainContent) return;

            // Hide all pages first
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            
            let htmlContent = '';
            switch (pageId) {
                case 'dashboard':
                    htmlContent = financialOverviewHTML; // Default to financial overview
                    break;
                case 'chart-of-accounts':
                    htmlContent = chartOfAccountsHTML;
                    break;
                case 'funds':
                    htmlContent = fundsHTML;
                    break;
                case 'journal-entries':
                    htmlContent = journalEntriesHTML;
                    break;
                case 'reports':
                    htmlContent = reportsHTML;
                    break;
                case 'settings':
                    htmlContent = settingsHTML;
                    break;
                default:
                    htmlContent = financialOverviewHTML; // Fallback
            }
            
            // This approach of replacing innerHTML for main pages is a bit crude
            // and will detach event listeners on elements within those pages.
            // A better approach would be to have all page HTML in the document
            // and toggle their display style, which is what the nav-item click handler does.
            // For now, we'll just ensure the correct page div is shown.
            const pageElement = document.getElementById(pageId + '-page');
            if (pageElement) {
                pageElement.style.display = 'block';
                if (pageId === 'dashboard') { // If dashboard, load its default panel
                    loadDashboardPanel('financial-overview-panel');
                }
            }
            // Re-initialize tabs if the loaded content has them
            if (pageId === 'chart-of-accounts' || pageId === 'settings') {
                initTabs();
            }
        }

        // Function to load dashboard panels (needs to be defined for initial load)
        function loadDashboardPanel(panelId) {
            const mainContent = document.getElementById('main-content');
            if (!mainContent) return;

            // Ensure we are on the dashboard page before trying to load panels
            const dashboardPage = document.getElementById('dashboard-page');
            if (!dashboardPage || !dashboardPage.classList.contains('active')) {
                // If not on dashboard, first navigate to dashboard
                document.querySelector('.nav-item[data-page=\"dashboard\"]').click();
                // Then, after a short delay to allow page load, load the panel
                setTimeout(() => {
                    loadDashboardPanelInternal(panelId);
                }, 50);
                return;
            }
            loadDashboardPanelInternal(panelId);
        }
        
        function loadDashboardPanelInternal(panelId) {
            document.querySelectorAll('.dashboard-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            const panelElement = document.getElementById(panelId);
            if (panelElement) {
                panelElement.classList.add('active');
            }
        }

        // Helper functions for sample data generation in drill-downs

        // Helper function to generate sample transaction data
        function generateSampleTransactions(accountName, totalAmount) {
            // Parse amount to a number for calculations
            const total = parseFloat(totalAmount.replace(/[$,()]/g, ''));
            const transactions = [];
            
            // If the total is zero, return an empty array
            if (total === 0) return transactions;
            
            // Generate random transactions that add up to the total
            let runningTotal = 0;
            
            // Generate between 3 and 8 transactions
            const numTransactions = Math.floor(Math.random() * 5) + 3;
            const isDebit = !totalAmount.includes('(');
            
            for (let i = 0; i < numTransactions; i++) {
                const isLast = i === numTransactions - 1;
                const txnAmount = isLast 
                    ? Math.abs(total - Math.abs(runningTotal)) 
                    : Math.abs(total) * (0.1 + Math.random() * 0.4);
                
                runningTotal += isDebit ? txnAmount : -txnAmount;
                
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 90)); // Random date in the last 90 days
                const dateStr = date.toISOString().split('T')[0];
                
                transactions.push({
                    date: dateStr,
                    reference: `JE-2025-${Math.floor(1000 + Math.random() * 9000)}`,
                    description: getRandomDescription(accountName),
                    fund: getRandomFund(),
                    debit: isDebit ? formatCurrency(txnAmount) : '$0.00',
                    credit: !isDebit ? formatCurrency(txnAmount) : '$0.00',
                    balance: formatCurrency(Math.abs(runningTotal))
                });
            }
            
            // Sort transactions by date, most recent first
            transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            return transactions;
        }

        // Helper function to generate sample fund breakdown
        function generateSampleFundBreakdown(categoryName, totalAmount) {
            // Parse amount to a number for calculations
            const total = parseFloat(totalAmount.replace(/[$,()]/g, ''));
            const funds = [];
            
            // If the total is zero, return an empty array
            if (total === 0) return funds;
            
            // Generate between 2 and 4 fund entries
            const numFunds = Math.floor(Math.random() * 3) + 2;
            let remaining = Math.abs(total);
            
            for (let i = 0; i < numFunds; i++) {
                const isLast = i === numFunds - 1;
                const amount = isLast ? remaining : remaining * (0.2 + Math.random() * 0.5);
                remaining -= amount;
                
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 90));
                const dateStr = date.toISOString().split('T')[0];
                
                funds.push({
                    fund: getRandomFund(),
                    description: `${categoryName} - ${getRandomDescription(categoryName)}`,
                    amount: formatCurrency(amount),
                    date: dateStr
                });
            }
            
            return funds;
        }

        // Helper function to generate sample vendor breakdown
        function generateSampleVendorBreakdown(expenseCategory, totalAmount) {
            // Parse amount to a number for calculations
            const total = parseFloat(totalAmount.replace(/[$,()]/g, ''));
            const vendors = [];
            
            // If the total is zero, return an empty array
            if (total === 0) return vendors;
            
            // Generate between 2 and 5 vendor entries
            const numVendors = Math.floor(Math.random() * 4) + 2;
            let remaining = Math.abs(total);
            
            const vendorList = ['Acme Supplies', 'Metrolink Services', 'Quantum IT Solutions', 'Apex Consulting', 'Highland Properties', 'Citywide Utilities'];
            
            for (let i = 0; i < numVendors; i++) {
                const isLast = i === numVendors - 1;
                const amount = isLast ? remaining : remaining * (0.2 + Math.random() * 0.5);
                remaining -= amount;
                
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 90));
                const dateStr = date.toISOString().split('T')[0];
                
                vendors.push({
                    vendor: vendorList[Math.floor(Math.random() * vendorList.length)],
                    date: dateStr,
                    reference: `AP-${Math.floor(1000 + Math.random() * 9000)}`,
                    description: `${expenseCategory} - ${getRandomDescription(expenseCategory)}`,
                    amount: formatCurrency(amount)
                });
            }
            
            // Sort by amount, largest first
            vendors.sort((a, b) => parseFloat(b.amount.replace(/[$,]/g, '')) - parseFloat(a.amount.replace(/[$,]/g, '')));
            
            return vendors;
        }

        // Helper function to generate monthly breakdown for budget vs actual
        function generateSampleMonthlyBreakdown(category, totalAmount) {
            const months = ['January', 'February', 'March', 'April', 'May', 'June', 
                           'July', 'August', 'September', 'October', 'November', 'December'];
            const result = [];
            
            // Parse the total amount
            const totalActual = parseFloat(totalAmount.replace(/[$,()]/g, ''));
            // Generate a reasonable budget total that's somewhat close to the actual
            const varianceFactor = 0.85 + (Math.random() * 0.3); // Between 85% and 115% of actual
            const totalBudget = totalActual * varianceFactor;
            
            // In a real app, we would have actual monthly data
            // For this example, we'll generate some random monthly figures
            let remainingBudget = totalBudget;
            let remainingActual = totalActual;
            
            // We'll show data for the past 6 months
            const currentMonth = new Date().getMonth();
            for (let i = 5; i >= 0; i--) {
                const monthIndex = (currentMonth - i + 12) % 12; // Handle wrapping around to previous year
                const monthName = months[monthIndex];
                
                const isLast = i === 0;
                const budgetAmount = isLast ? remainingBudget : remainingBudget * (0.1 + Math.random() * 0.3);
                const actualAmount = isLast ? remainingActual : remainingActual * (0.1 + Math.random() * 0.3);
                
                remainingBudget -= budgetAmount;
                remainingActual -= actualAmount;
                
                const variance = actualAmount - budgetAmount;
                const percentVariance = budgetAmount === 0 ? '0.0%' : ((variance / budgetAmount) * 100).toFixed(1) + '%';
                
                result.push({
                    month: monthName,
                    budget: formatCurrency(budgetAmount),
                    actual: formatCurrency(actualAmount),
                    variance: formatCurrency(variance),
                    percentVariance: percentVariance
                });
            }
            
            return result;
        }

        // Helper function to get a random description based on account/category
        function getRandomDescription(category) {
            const category_lower = category.toLowerCase();
            const descriptions = {
                'cash': ['Deposit', 'Transfer from savings', 'Bank fee', 'ATM withdrawal'],
                'operating checking': ['Program payment', 'Vendor payment', 'Payroll deposit', 'Direct deposit'],
                'savings': ['Interest earned', 'Transfer to checking', 'Grant deposit', 'Reserve funds'],
                'accounts receivable': ['Invoice #34520', 'Grant payment', 'Client services', 'Contract payment'],
                'accounts payable': ['Vendor invoice', 'Utility payment', 'Contract services', 'Monthly service'],
                'revenue': ['Monthly donation', 'Program fee', 'Grant disbursement', 'Service contract'],
                'contributions': ['Major donor gift', 'Monthly giving', 'Fundraising event', 'Corporate match'],
                'grants': ['Foundation grant', 'Government contract', 'Capacity building grant', 'Program support'],
                'program': ['Staff salary', 'Program supplies', 'Client assistance', 'Training materials'],
                'salaries': ['Staff payroll', 'Contractor payment', 'Benefits allocation', 'Tax withholding'],
                'occupancy': ['Office rent', 'Utilities payment', 'Maintenance service', 'Facilities improvement'],
                'insurance': ['Liability coverage', 'Employee benefits', 'Directors & Officers', 'Property insurance'],
                // Default descriptions if category doesn't match any of the above
                'default': ['Monthly transaction', 'Regular payment', 'Standard service', 'Recurring expense']
            };
            
            // Find matching category or use default
            let categoryDescriptions = descriptions.default;
            
            for (const key in descriptions) {
                if (category_lower.includes(key)) {
                    categoryDescriptions = descriptions[key];
                    break;
                }
            }
            
            return categoryDescriptions[Math.floor(Math.random() * categoryDescriptions.length)];
        }

        // Helper function to get a random fund
        function getRandomFund() {
            const funds = ['General Operating', 'Program Services', 'Building Fund', 'Endowment'];
            return funds[Math.floor(Math.random() * funds.length)];
        }

        // Helper function to format currency
        function formatCurrency(amount) {
            const num = parseFloat(String(amount).replace(/[$,()]/g, ''));
            if (isNaN(num)) return '$0.00';
            const formatted = '$' + Math.abs(num).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            return amount < 0 ? `(${formatted})` : formatted;
        }

        /* ------------------------------------------------------------------
           Custom Report Builder Functionality
        ------------------------------------------------------------------*/
        function initReportBuilder() {
            // Button to open the report-builder modal
            const createReportBtn = document.getElementById('create-custom-report');
            if (createReportBtn) {
                createReportBtn.addEventListener('click', () => {
                    openModal('report-builder-modal');
                    // Reset basic form fields
                    document.getElementById('report-name').value = '';
                    document.getElementById('report-description').value = '';
                    const selected = document.getElementById('selected-fields');
                    if (selected) {
                        selected.innerHTML =
                            '<div class="preview-placeholder">Drag or click fields from the left to add them to your report</div>';
                    }
                    updateReportPreview();
                });
            }

            // Field selection handling
            const availableFields = document.getElementById('available-fields');
            const selectedFieldsContainer = document.getElementById('selected-fields');

            if (availableFields && selectedFieldsContainer) {
                availableFields.querySelectorAll('.field-item').forEach(field => {
                    field.addEventListener('click', function () {
                        const fieldName = this.textContent;
                        const fieldId   = this.getAttribute('data-field');

                        // Remove placeholder
                        const placeholder = selectedFieldsContainer.querySelector('.preview-placeholder');
                        if (placeholder) placeholder.remove();

                        // Do not duplicate same field
                        if (selectedFieldsContainer.querySelector(`.selected-field[data-field=\"${fieldId}\"]`)) return;

                        const wrapper = document.createElement('div');
                        wrapper.className = 'selected-field';
                        wrapper.setAttribute('data-field', fieldId);
                        wrapper.innerHTML = `
                            <span>${fieldName}</span>
                            <button type="button" class="remove-field">&times;</button>
                        `;
                        selectedFieldsContainer.appendChild(wrapper);

                        // Remove handler
                        wrapper.querySelector('.remove-field').addEventListener('click', () => {
                            wrapper.remove();
                            if (selectedFieldsContainer.children.length === 0) {
                                selectedFieldsContainer.innerHTML =
                                  '<div class="preview-placeholder">Drag or click fields from the left to add them to your report</div>';
                            }
                            updateReportPreview();
                            updateSortingOptions();
                        });

                        updateReportPreview();
                        updateSortingOptions();
                    });
                });
            }
        }

        // --- simple stubs so code runs without errors; will be filled later ---
        function updateReportPreview() {
            /* TODO: generate preview from selected fields */
        }
        function updateSortingOptions() {
            /* TODO: update sort/group dropdowns based on selected fields */
        }
    </script>
</body>
</html>