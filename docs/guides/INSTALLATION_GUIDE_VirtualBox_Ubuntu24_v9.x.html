<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VirtualBox Ubuntu 24.04 Installation Guide v9.x</title>
    <style>
        /* Print-specific styles */
        @page {
            size: letter;
            margin: 1in 0.75in;
        }
        
        @media print {
            .page-break {
                page-break-before: always;
            }
            
            thead {
                display: table-header-group;
            }
            
            tfoot {
                display: table-footer-group;
            }
            
            body {
                margin: 0;
                padding: 0;
            }
            
            a {
                text-decoration: none;
                color: #000;
            }
            
            .no-print {
                display: none;
            }
            
            /* Print header and footer on each page */
            @page {
                @top-center {
                    content: "Non-Profit Fund Accounting System v9.x";
                }
                @bottom-center {
                    content: "Page " counter(page) " of " counter(pages);
                }
                @bottom-right {
                    content: "July 23, 2025";
                }
            }
        }
        
        /* General styles */
        body {
            font-family: Arial, Helvetica, sans-serif;
            line-height: 1.5;
            color: #333;
            margin: 0;
            padding: 0 20px;
            max-width: 8.5in;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 2em;
            padding-bottom: 1em;
            border-bottom: 2px solid #2c5aa0;
        }
        
        .header h1 {
            color: #2c5aa0;
            font-size: 24pt;
            margin-bottom: 0.2em;
        }
        
        .header h2 {
            color: #555;
            font-size: 18pt;
            font-weight: normal;
            margin-top: 0;
        }
        
        .header .date {
            color: #777;
            font-size: 12pt;
            margin-top: 1em;
        }
        
        /* Table of Contents */
        .toc {
            margin: 2em 0 3em 0;
        }
        
        .toc h2 {
            color: #2c5aa0;
            font-size: 16pt;
            margin-bottom: 1em;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.3em;
        }
        
        .toc ul {
            list-style-type: none;
            padding: 0;
        }
        
        .toc li {
            margin-bottom: 0.5em;
            display: flex;
        }
        
        .toc-item {
            flex-grow: 1;
        }
        
        .toc-dots {
            flex-grow: 1;
            border-bottom: 1px dotted #ccc;
            margin: 0 5px;
            position: relative;
            top: -5px;
        }
        
        /* Headings */
        h1, h2, h3, h4 {
            color: #2c5aa0;
            page-break-after: avoid;
        }
        
        h1 {
            font-size: 18pt;
            margin-top: 2em;
            border-bottom: 1px solid #ddd;
            padding-bottom: 0.3em;
        }
        
        h2 {
            font-size: 16pt;
            margin-top: 1.5em;
        }
        
        h3 {
            font-size: 14pt;
            margin-top: 1.2em;
        }
        
        /* Code blocks */
        code, pre {
            font-family: 'Courier New', monospace;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        code {
            padding: 2px 5px;
            font-size: 90%;
        }
        
        pre {
            padding: 10px;
            overflow-x: auto;
            line-height: 1.4;
            margin: 1em 0;
            white-space: pre-wrap;
            page-break-inside: avoid;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5em 0;
            page-break-inside: avoid;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px 12px;
            text-align: left;
        }
        
        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }
        
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        /* Special sections */
        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            page-break-inside: avoid;
        }
        
        .info {
            background-color: #e7f5ff;
            border-left: 4px solid #0d6efd;
            padding: 15px;
            margin: 15px 0;
            page-break-inside: avoid;
        }
        
        .success {
            background-color: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            page-break-inside: avoid;
        }
        
        /* Links */
        a {
            color: #0366d6;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        /* Horizontal rule */
        hr {
            border: 0;
            height: 1px;
            background-color: #ddd;
            margin: 2em 0;
        }
        
        /* Footer */
        .footer {
            margin-top: 3em;
            padding-top: 1em;
            border-top: 1px solid #ddd;
            text-align: center;
            color: #777;
            font-size: 10pt;
        }
        
        /* Utility classes */
        .text-center {
            text-align: center;
        }
        
        .text-right {
            text-align: right;
        }
        
        .no-break {
            page-break-inside: avoid;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Non-Profit Fund Accounting System v9.x</h1>
        <h2>Installation Guide – Ubuntu 24.04 LTS Guest in VirtualBox</h2>
        <div class="date">July 23, 2025</div>
    </div>
    
    <div class="toc">
        <h2>Table of Contents</h2>
        <ul>
            <li>
                <span class="toc-item">1. Overview</span>
                <span class="toc-dots"></span>
                <span class="toc-page">1</span>
            </li>
            <li>
                <span class="toc-item">2. Prerequisites & Host Requirements</span>
                <span class="toc-dots"></span>
                <span class="toc-page">1</span>
            </li>
            <li>
                <span class="toc-item">3. Create the VirtualBox VM</span>
                <span class="toc-dots"></span>
                <span class="toc-page">2</span>
            </li>
            <li>
                <span class="toc-item">4. Install Runtime Dependencies inside the VM</span>
                <span class="toc-dots"></span>
                <span class="toc-page">3</span>
            </li>
            <li>
                <span class="toc-item">5. Application Installation</span>
                <span class="toc-dots"></span>
                <span class="toc-page">4</span>
            </li>
            <li>
                <span class="toc-item">6. Database Setup</span>
                <span class="toc-dots"></span>
                <span class="toc-page">5</span>
            </li>
            <li>
                <span class="toc-item">7. Run the Application</span>
                <span class="toc-dots"></span>
                <span class="toc-page">6</span>
            </li>
            <li>
                <span class="toc-item">8. Testing & Verification Checklist</span>
                <span class="toc-dots"></span>
                <span class="toc-page">7</span>
            </li>
            <li>
                <span class="toc-item">9. Troubleshooting</span>
                <span class="toc-dots"></span>
                <span class="toc-page">7</span>
            </li>
            <li>
                <span class="toc-item">10. Performance Tips</span>
                <span class="toc-dots"></span>
                <span class="toc-page">8</span>
            </li>
            <li>
                <span class="toc-item">11. Security Considerations</span>
                <span class="toc-dots"></span>
                <span class="toc-page">8</span>
            </li>
            <li>
                <span class="toc-item">12. Appendix A – Useful Commands</span>
                <span class="toc-dots"></span>
                <span class="toc-page">9</span>
            </li>
        </ul>
    </div>
    
    <hr>
    
    <h1 id="overview">1. Overview</h1>
    <p>
        This guide walks through a <strong>clean installation</strong> of the Non-Profit Fund Accounting System v9.x inside an Ubuntu 24.04 LTS virtual machine (VM) running under Oracle VM VirtualBox.
    </p>
    <p>
        The procedure matches the <strong>working macOS reference environment</strong> (Node.js 18, PostgreSQL 16, Express 5) and leverages the project's cross-platform automation scripts.
    </p>
    
    <hr>
    
    <h1 id="prerequisites">2. Prerequisites & Host Requirements</h1>
    <table>
        <thead>
            <tr>
                <th>Component</th>
                <th>Minimum</th>
                <th>Recommended</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Host OS</td>
                <td>Windows 10/11 or macOS 13+</td>
                <td>—</td>
            </tr>
            <tr>
                <td>CPU</td>
                <td>4 physical cores with VT-x / AMD-V</td>
                <td>6+ cores</td>
            </tr>
            <tr>
                <td>RAM</td>
                <td>8 GB</td>
                <td>16 GB (allocate ≥ 6 GB to guest)</td>
            </tr>
            <tr>
                <td>Disk</td>
                <td>40 GB free</td>
                <td>80 GB on SSD / NVMe</td>
            </tr>
            <tr>
                <td>Software</td>
                <td>Oracle VirtualBox ≥ 7.0, Ubuntu 24.04 Desktop ISO</td>
                <td>—</td>
            </tr>
        </tbody>
    </table>
    
    <div class="warning">
        <strong>Important:</strong> Enable hardware virtualization in BIOS/UEFI before installing VirtualBox.
    </div>
    
    <hr>
    
    <h1 id="virtualbox-setup">3. Create the VirtualBox VM</h1>
    
    <h3>3.1 Download software</h3>
    <ul>
        <li>VirtualBox: <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></li>
        <li>Ubuntu 24.04 ISO: <a href="https://ubuntu.com/download/desktop">https://ubuntu.com/download/desktop</a></li>
    </ul>
    
    <h3>3.2 New VM</h3>
    <ul>
        <li>Name <code>Ubuntu24-FundAcct-v9x</code></li>
        <li>Type <em>Linux</em> → Version <em>Ubuntu (64-bit)</em></li>
        <li>Memory <strong>6144 MB</strong> • Processors <strong>4 vCPU</strong></li>
        <li>Disk <strong>VDI</strong>, dynamically allocated, <strong>60 GB</strong></li>
    </ul>
    
    <h3>3.3 Tweaks</h3>
    <p>
        Display → Graphics Controller <strong>VBoxSVGA</strong>, enable <strong>3-D Acceleration</strong><br>
        Network Adapter 1 → <strong>Bridged</strong> (preferred) or <strong>NAT</strong><br>
        Storage → attach the Ubuntu ISO.
    </p>
    
    <h3>3.4 Install Ubuntu</h3>
    <p>
        Normal installation, enable third-party codecs (optional).<br>
        Create user <strong>fundadmin</strong> (will have <code>sudo</code>).<br>
        After first boot:
    </p>
    <pre><code>sudo apt update && sudo apt -y upgrade
sudo reboot</code></pre>
    
    <hr class="page-break">
    
    <h1 id="dependencies">4. Install Runtime Dependencies inside the VM</h1>
    
    <pre><code># Essential tools
sudo apt install -y git build-essential curl

# Node.js 18 LTS (via NodeSource)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs   # node 18.x, npm 10.x+

# PostgreSQL 16 (official PGDG repository)
echo "deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main" | \
  sudo tee /etc/apt/sources.list.d/pgdg.list
curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add -
sudo apt update
sudo apt install -y postgresql-16

# Verify toolchain
node -v   # v18.x
npm  -v   # 10.x+
psql -V   # 16.x</code></pre>
    
    <hr>
    
    <h1 id="installation">5. Application Installation</h1>
    
    <h3 id="clone-repo">5.1 Clone the Repository</h3>
    <pre><code>sudo mkdir -p /opt && cd /opt
sudo git clone https://github.com/tpfbill/nonprofit-fund-accounting-v9.x.git
sudo chown -R $USER:$USER nonprofit-fund-accounting-v9.x
cd nonprofit-fund-accounting-v9.x</code></pre>
    
    <h3 id="env-file">5.2 Create .env</h3>
    <pre><code>cat > .env <<'EOF'
# Database
PGHOST=localhost
PGPORT=5432
PGDATABASE=fund_accounting_db
PGUSER=npfadmin
PGPASSWORD=npfa123

# Server
PORT=3000
EOF
chmod 600 .env</code></pre>
    
    <h3 id="dependencies">5.3 Install Node Dependencies</h3>
    <pre><code>npm ci</code></pre>
    
    <div class="info">
        <strong>Dependencies (excerpt from <em>package.json</em>):</strong>
        <ul>
            <li>express <strong>5.1.0</strong></li>
            <li>pg 8.16</li>
            <li>http-server 14.1</li>
            <li>concurrently 8.2</li>
        </ul>
    </div>
    
    <hr class="page-break">
    
    <h1 id="database-setup">6. Database Setup</h1>
    
    <h3 id="setup-option-a">Option A (one-line, interactive)</h3>
    <p>Run the hardened Ubuntu helper script (idempotent):</p>
    <pre><code>scripts/setup-ubuntu-database.sh</code></pre>
    
    <div class="info">
        <strong>The script:</strong>
        <ol>
            <li>Ensures PostgreSQL service is running.</li>
            <li>Creates role <strong>npfadmin / npfa123</strong>.</li>
            <li>Creates database <strong>fund_accounting_db</strong> owned by <code>npfadmin</code>.</li>
            <li>Executes <code>database/db-init.sql</code> (core schema) and
            <code>database/nacha-vendor-payments-schema.sql</code> (ACH vendor payments).</li>
            <li>Loads demo data via <code>database/load-principle-foundation-data.js</code>.</li>
            <li>Writes/updates the <code>.env</code> file and verifies connectivity.</li>
        </ol>
    </div>
    
    <h3 id="setup-option-b">Option B (manual)</h3>
    <pre><code># 1. Create role & DB (cross-platform SQL)
sudo -u postgres psql -f database/setup-database-cross-platform.sql

# 2. Core schema
sudo -u postgres psql -d fund_accounting_db -f database/db-init.sql

# 3. NACHA vendor-payment extension
sudo -u postgres psql -d fund_accounting_db -f database/nacha-vendor-payments-schema.sql

# 4. (Optional) Demo data
node database/load-principle-foundation-data.js</code></pre>
    
    <hr>
    
    <h1 id="run-application">7. Run the Application</h1>
    
    <p>Open <strong>two terminals</strong> or use <code>npm run dev</code>.</p>
    
    <pre><code># Terminal 1 – REST API (port 3000)
node server.js</code></pre>
    
    <pre><code># Terminal 2 – Static front-end (port 8080)
npx http-server . -p 8080 --no-cache</code></pre>
    
    <p>Helper scripts:</p>
    
    <pre><code>npm run client   # only front-end
npm run dev      # backend + frontend concurrently</code></pre>
    
    <p>Browse to <strong>http://localhost:8080/index.html</strong>.</p>
    
    <hr class="page-break">
    
    <h1 id="testing">8. Testing & Verification Checklist</h1>
    
    <table>
        <thead>
            <tr>
                <th>Test</th>
                <th>Steps</th>
                <th>Expected</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>API health</td>
                <td><code>curl http://localhost:3000/api/health</code></td>
                <td><code>{"status":"ok"}</code></td>
            </tr>
            <tr>
                <td>Dashboard</td>
                <td>Open <code>/index.html</code></td>
                <td>Summary cards and charts render</td>
            </tr>
            <tr>
                <td>Vendor Directory</td>
                <td><em>Vendor Payments ➜ Vendors</em></td>
                <td>List shows, <strong>Add Vendor</strong> modal works</td>
            </tr>
            <tr>
                <td>Payment Batch</td>
                <td><em>Vendor Payments ➜ Batches ➜ New</em></td>
                <td>Entity & Fund dropdowns populate</td>
            </tr>
            <tr>
                <td>NACHA File</td>
                <td>Create batch ➜ Approve ➜ <strong>Generate NACHA</strong></td>
                <td><code>.ACH</code> file appears & downloads</td>
            </tr>
            <tr>
                <td>DB inspection</td>
                <td><code>psql -d fund_accounting_db -c '\dt'</code></td>
                <td>16 tables incl. <code>payment_batches</code>, <code>nacha_files</code></td>
            </tr>
        </tbody>
    </table>
    
    <hr>
    
    <h1 id="troubleshooting">9. Troubleshooting</h1>
    
    <table>
        <thead>
            <tr>
                <th>Symptom</th>
                <th>Resolution</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>"DB offline" badge</td>
                <td><code>sudo systemctl restart postgresql</code> and verify <code>.env</code></td>
            </tr>
            <tr>
                <td>Port 3000 in use</td>
                <td><code>sudo lsof -i:3000</code> → <code>kill &lt;PID&gt;</code></td>
            </tr>
            <tr>
                <td>Empty dropdowns (batch modal)</td>
                <td>Re-run step 6.3 (NACHA schema) & restart API</td>
            </tr>
            <tr>
                <td>CSS not updating</td>
                <td>Hard-refresh (Ctrl-F5) or <code>--no-cache</code> flag</td>
            </tr>
            <tr>
                <td>Script permission denied</td>
                <td><code>chmod +x scripts/setup-ubuntu-database.sh</code></td>
            </tr>
        </tbody>
    </table>
    
    <hr class="page-break">
    
    <h1 id="performance">10. Performance Tips</h1>
    
    <ol>
        <li>Allocate extra vCPU/RAM to the VM.</li>
        <li>Enable <strong>Nested Paging</strong> & <strong>KVM Paravirtualization</strong> in VirtualBox.</li>
        <li>Store the VDI on an SSD/NVMe host drive.</li>
        <li>Tune PostgreSQL (<code>shared_buffers = 512MB</code>, <code>work_mem = 16MB</code>).</li>
        <li>Use <strong>Bridged</strong> networking for faster host↔guest transfers.</li>
    </ol>
    
    <hr>
    
    <h1 id="security">11. Security Considerations</h1>
    
    <ul>
        <li>Change default passwords (<code>npfa123</code>) before production.</li>
        <li>Keep <code>.env</code> file <strong>chmod 600</strong> and outside version control.</li>
        <li>Enable UFW:
            <pre><code>sudo ufw allow 8080/tcp
sudo ufw allow 3000/tcp
sudo ufw enable</code></pre>
        </li>
        <li>Regularly apply <code>apt upgrade</code> and PostgreSQL minor updates.</li>
        <li>Snapshot the VM after successful installation.</li>
    </ul>
    
    <hr>
    
    <h1 id="appendix">12. Appendix A – Useful Commands</h1>
    
    <pre><code># Stop both services
pkill -f http-server
pkill -f node

# Backup the database
sudo -u postgres pg_dump -Fc fund_accounting_db > fundacct_$(date +%F).dump

# Restore
sudo -u postgres pg_restore -d fund_accounting_db -c fundacct_2025-07-22.dump</code></pre>
    
    <hr>
    
    <div class="success text-center">
        <strong>Enjoy your fully-functional Non-Profit Fund Accounting System v9.x on Ubuntu 24.04!</strong>
    </div>
    
    <p class="text-center">
        For details on API endpoints and data model, see the in-app <strong>Documentation</strong> tab or <code>README.md</code>.
    </p>
    
    <div class="footer">
        <p>Non-Profit Fund Accounting System v9.x Installation Guide • July 23, 2025</p>
        <p>© 2025 The Principle Foundation</p>
    </div>
</body>
</html>
